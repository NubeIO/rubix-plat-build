(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"+SqX":function(e,t,i){"use strict";var n={name:"page-title",props:["title"]},a=i("psIG"),s=Object(a.a)(n,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("h1",{staticClass:"text-h5 text-left py-3"},[e._v(e._s(e.title))])}),[],!1,null,null,null);t.a=s.exports},0:function(e,t){},1:function(e,t){},2:function(e,t){},"3saC":function(e,t,i){"use strict";var n={props:["on-copy"],methods:{copyToClipboard:function(e){var t=this;this.$copyText(e,this.$refs.copyClipboard).then((function(){t.$toasted.show("Copied to clipboard!",{type:"success"})}),(function(){t.$toasted.show("Cannot copy to clipboard.",{type:"error"})}))}}},a=i("psIG"),s=Object(a.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{ref:"copyClipboard"},[i("v-btn",{staticClass:"white-text",attrs:{"x-small":"",color:"#009688"},on:{click:function(){return e.onCopy(e.copyToClipboard)}}},[i("span",[e._v("Copy  ")]),e._v(" "),i("v-icon",{attrs:{small:""}},[e._v("mdi-export")])],1)],1)}),[],!1,null,null,null);t.a=s.exports},OKta:function(e,t,i){"use strict";var n={name:"rbx-button",props:["title","after-icon","color","click","is-small","class-name","disabled","block","loading"]},a=i("psIG"),s=Object(a.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-btn",{class:e.className,attrs:{loading:e.loading,"x-small":e.isSmall,disabled:e.disabled,color:e.color,block:e.block},on:{click:e.click}},[i("span",[e._v(e._s(e.title)+" ")]),e._v(" "),e.afterIcon?i("v-icon",{attrs:{small:e.isSmall}},[e._v(e._s(e.afterIcon))]):e._e()],1)}),[],!1,null,null,null);t.a=s.exports},Q12t:function(e,t,i){"use strict";var n=i("/9Wh"),a=i.n(n),s=i("+n12"),r={name:"export-data",props:["data","fileName","formatDataService"],methods:{clickDownload:function(e,t){var i=e;switch("function"==typeof this.formatDataService&&(i=this.formatDataService(e)),t){case"csv":return Object(s.c)(this.fileName,i);case"excel":return Object(s.e)(this.fileName,i);case"json":return Object(s.f)(this.fileName,a()(i))}}}},o=i("psIG"),c=Object(o.a)(r,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,a=t.attrs;return[i("v-btn",e._g(e._b({staticClass:"white--text mr-2",attrs:{"x-small":"",color:"#009688",dark:""}},"v-btn",a,!1),n),[i("span",[e._v("Download")]),e._v(" "),i("v-icon",{attrs:{"x-small":"",right:"",dark:""}},[e._v("mdi-download")])],1)]}}])},[e._v(" "),i("v-list",[i("v-list-item",{attrs:{link:""}},[i("v-list-item-title",{on:{click:function(t){return e.clickDownload(e.data,"json")}}},[e._v("Json")])],1),e._v(" "),i("v-list-item",{attrs:{link:""}},[i("v-list-item-title",{on:{click:function(t){return e.clickDownload(e.data,"excel")}}},[e._v("Excel")])],1),e._v(" "),i("v-list-item",{attrs:{link:""}},[i("v-list-item-title",{on:{click:function(t){return e.clickDownload(e.data,"csv")}}},[e._v("CSV")])],1)],1)],1)}),[],!1,null,null,null);t.a=c.exports},YfxP:function(e,t,i){"use strict";var n={name:"full-screen-container",props:["title","on-back"]},a=i("psIG"),s=Object(a.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-card",[i("v-card-title",[i("v-btn",{staticClass:"white--text mr-1",attrs:{icon:"",medium:""},on:{click:e.onBack}},[i("v-icon",{attrs:{medium:"",dark:""}},[e._v(" mdi-arrow-left ")])],1),e._v(" "),i("v-container",{staticClass:"text-left",attrs:{fluild:""}},[e._v(e._s(e.title))])],1),e._v(" "),i("v-container",{attrs:{fluid:""}},[e._t("default")],2)],1)}),[],!1,null,null,null);t.a=s.exports},Zepl:function(e,t,i){"use strict";t.a={required:function(e){return!!e||"Required"},number:function(e){return!function(e){return isNaN(+e)}(e)||"Value should be a number"},isIpAddress:function(e){return!(!/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(t=e)&&!/(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]/g.test(t)&&"localhost"!==(""+t).toLowerCase())||"Invalid IP Address";var t},isJsonString:function(e){return function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(e)||"Data should be in a valid JSON format"}}},lkCm:function(e,t,i){"use strict";var n={name:"confirm-dialog",props:["on-close","on-confirm","dialog-text","is-open","loading"]},a=i("psIG"),s=Object(a.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-dialog",{attrs:{persistent:"","max-width":"290"},model:{value:e.isOpen,callback:function(t){e.isOpen=t},expression:"isOpen"}},[i("v-card",[i("v-card-title",[i("v-icon",{attrs:{color:"warning"}},[e._v(" mdi-alert-outline ")]),e._v(" Confirm ")],1),e._v(" "),i("v-card-text",[i("v-container",[i("v-row",[e._v(e._s(e.dialogText))])],1)],1),e._v(" "),i("v-card-actions",[i("v-spacer"),e._v(" "),i("v-btn",{attrs:{text:""},on:{click:e.onClose}},[e._v(" No ")]),e._v(" "),i("v-btn",{attrs:{color:"red darken-1",loading:e.loading,text:""},on:{click:e.onConfirm}},[e._v(" Yes ")])],1)],1)],1)}),[],!1,null,null,null);t.a=s.exports},rRpL:function(e,t,i){"use strict";i.r(t);var n=i("Kz1y"),a=i.n(n),s=i("+SqX"),r=i("TcPG"),o=i.n(r),c=i("OKta"),l=i("Zepl"),d={components:{RbxButton:c.a},props:["toList","fromList","isEditForm","onCancel","serviceMapping","mappingListLeft","mappingListRight","mappingRightKey","mappingLeftKey","serviceMappings","createServiceMapping","mappingSelectionLeftTitle","mappingSelectionRightTitle"],data:function(){return{uuid:null,valid:!1,selectedToList:[],selectedLeft:null,selectedRight:null,isCreatingMapping:!1,fieldValidations:[l.a.required]}},mounted:function(){this.isEditForm&&this.serviceMapping&&(this.uuid=this.serviceMapping.uuid,this.selectedLeft=this.serviceMapping[this.mappingLeftKey],this.selectedRight=this.serviceMapping[this.mappingRightKey],this.fieldValidations=[])},computed:{mappings:function(){return this.serviceMappings},selectedMappingListLeft:function(){var e=this;return this.serviceMappings.map((function(t){return t[e.mappingLeftKey]}))},selectedMappingListRight:function(){var e=this;return this.serviceMappings.map((function(t){return t[e.mappingRightKey]}))},updatedMappingListLeft:function(){return this.updateLisItemProperty(this.mappingListLeft,this.selectedMappingListLeft)},updatedMappingListRight:function(){return this.updateLisItemProperty(this.mappingListRight,this.selectedMappingListRight)}},methods:{addMapping:function(){var e,t=this;this.$refs.serviceMappingForm.validate()&&(this.selectedMappingListLeft.push(this.selectedLeft),this.selectedMappingListRight.push(this.selectedRight),this.isCreatingMapping=!0,this.createServiceMapping((e={},o()(e,this.mappingLeftKey,this.selectedLeft),o()(e,this.mappingRightKey,this.selectedRight),e),this.uuid).then((function(){if(t.isEditForm)return t.onCancel();t.selectedLeft=null,t.selectedRight=null,t.$refs.serviceMappingForm.reset()})).finally((function(){t.isCreatingMapping=!1})))},updateLisItemProperty:function(e,t){if(!t)return e;var i=t.filter((function(e){return e})).map((function(e){return e.id}));return e.reduce((function(e,t){return i.includes(t.id)?t.disabled=!0:t.disabled=!1,e.push(t),e}),[])}}},u=i("psIG"),p=Object(u.a)(d,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-form",{ref:"serviceMappingForm",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[i("v-row",[i("v-col",{attrs:{cols:e.isEditForm?12:5}},[i("v-autocomplete",{attrs:{items:e.updatedMappingListLeft,"auto-select-first":"",clearable:"","item-text":"name","item-value":"id",rules:e.fieldValidations,label:e.mappingSelectionLeftTitle,"return-object":""},model:{value:e.selectedLeft,callback:function(t){e.selectedLeft=t},expression:"selectedLeft"}})],1),e._v(" "),i("v-col",{attrs:{cols:e.isEditForm?12:5}},[i("v-autocomplete",{attrs:{items:e.updatedMappingListRight,"auto-select-first":"",clearable:"","item-text":"name",rules:e.fieldValidations,"item-value":"id",label:e.mappingSelectionRightTitle,"return-object":""},model:{value:e.selectedRight,callback:function(t){e.selectedRight=t},expression:"selectedRight"}})],1),e._v(" "),e.isEditForm?e._e():i("v-col",{staticClass:"flex justify-center align-center",attrs:{cols:"2"}},[i("rbx-button",{attrs:{block:!0,loading:e.isCreatingMapping,color:"pink",click:e.addMapping,title:"Add"}})],1)],1),e._v(" "),e.isEditForm?i("v-card-actions",[i("v-spacer"),e._v(" "),i("v-btn",{attrs:{color:"darken-1",text:""},on:{click:e.onCancel}},[e._v(" Cancel ")]),e._v(" "),i("v-btn",{attrs:{color:"blue darken-1",loading:e.isCreatingMapping,text:""},on:{click:e.addMapping}},[e._v(" Save ")])],1):e._e()],1)}),[],!1,null,"3d8a2189",null).exports,v=i("/9Wh"),m=i.n(v),h=i("lkCm"),g=i("Q12t"),f=i("3saC"),b=i("Isj4"),P={name:"import-dialog",props:["receiveDataRows"],data:function(){return{file:null,dialogImportExcel:!1,dialogImportJSON:!1,dataImport:""}},methods:{importFile:function(){var e=new FileReader;e.readAsBinaryString(this.file),e.onload=this.handleFileLoad},handleFileLoad:function(e){var t=e.target.result,i=b.read(t,{type:"binary"}),n=Array.isArray(i.SheetNames)&&i.SheetNames.length>0&&i.SheetNames[0];if(!n)return this.$toasted.show("Invalid Excel File. Please reupload.",{type:"error"});var a=b.utils.sheet_to_row_object_array(i.Sheets[n]);this.receiveDataRows(a),this.dialogImportExcel=!1},importJson:function(){try{var e=JSON.parse(this.dataImport);this.receiveDataRows(e),this.dialogImportJSON=!1}catch(e){return this.$toasted.show("Invalid JSON",{type:"error"})}}}},_=Object(u.a)(P,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,a=t.attrs;return[i("v-btn",e._g(e._b({staticClass:"white--text mr-2",attrs:{"x-small":"",color:"primary"}},"v-btn",a,!1),n),[e._v("Import"),i("v-icon",{attrs:{"x-small":"",right:"",dark:""}},[e._v("mdi-import")])],1)]}}])},[e._v(" "),i("v-list",[i("v-list-item",{attrs:{link:""}},[i("v-list-item-title",{on:{click:function(t){e.dialogImportJSON=!0,e.dataImport=""}}},[e._v("Json")])],1),e._v(" "),i("v-list-item",{attrs:{link:""}},[i("v-list-item-title",{on:{click:function(t){e.dialogImportExcel=!0,e.file=null}}},[e._v("Excel")])],1)],1)],1),e._v(" "),i("v-dialog",{attrs:{width:"500px"},model:{value:e.dialogImportExcel,callback:function(t){e.dialogImportExcel=t},expression:"dialogImportExcel"}},[i("v-card",[i("v-card-title",[e._v("Choose excel file")]),e._v(" "),i("v-card-text",[i("v-file-input",{attrs:{outlined:"",dense:"",label:"File input",accept:".xls,.xlsx"},model:{value:e.file,callback:function(t){e.file=t},expression:"file"}})],1),e._v(" "),i("v-card-actions",[i("v-spacer"),e._v(" "),i("v-btn",{attrs:{color:"darken-1",text:""},on:{click:function(t){e.dialogImportExcel=!1}}},[e._v("Close")]),e._v(" "),i("v-btn",{attrs:{color:"primary darken-1",text:"",disabled:!e.file},on:{click:e.importFile}},[e._v("Import")])],1)],1)],1),e._v(" "),i("v-dialog",{attrs:{width:"500px"},model:{value:e.dialogImportJSON,callback:function(t){e.dialogImportJSON=t},expression:"dialogImportJSON"}},[i("v-card",[i("v-card-title",[e._v("Import via JSON")]),e._v(" "),i("v-card-text",[i("v-container",[i("v-textarea",{attrs:{outlined:"",name:"input-7-4",label:"import data"},model:{value:e.dataImport,callback:function(t){e.dataImport=t},expression:"dataImport"}})],1)],1)],1),e._v(" "),i("v-card-actions",[i("v-btn",{attrs:{color:"primary darken-1",text:"",disabled:!e.dataImport},on:{click:e.importJson}},[e._v("Import")])],1)],1)],1)}),[],!1,null,null,null).exports,M={name:"grid-toolbar",props:["toolbarTitle","onCopy","items","fileName","formatDataService","receiveDataRows","onDelete","isDeleteEnabled","onSearch"],components:{ExportData:g.a,CopyClipboard:f.a,ImportDialog:_}},y=Object(u.a)(M,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-toolbar",{attrs:{flat:""}},[i("v-toolbar-title",{staticClass:"mr-6"},[e._v(e._s(e.toolbarTitle))]),e._v(" "),e.onCopy?i("copy-clipboard",{staticClass:"mr-2",attrs:{"on-copy":e.onCopy}}):e._e(),e._v(" "),e.items&&e.items.length>0?i("export-data",{attrs:{data:e.items,"file-name":e.fileName,"format-data-service":e.formatDataService}}):e._e(),e._v(" "),e.receiveDataRows?i("import-dialog",{attrs:{receiveDataRows:e.receiveDataRows}}):e._e(),e._v(" "),e.onDelete?i("v-btn",{staticClass:"white--text",attrs:{disabled:!e.isDeleteEnabled,"x-small":"",color:"error"},on:{click:e.onDelete}},[e._v("\n    Delete\n    "),i("v-icon",{attrs:{"x-small":"",right:"",dark:""}},[e._v(" mdi-delete ")])],1):e._e(),e._v(" "),e._t("search")],2)}),[],!1,null,null,null).exports,k={name:"service-mapping-grid",props:["loading","mappingRightKey","mappingListRight","mappingListLeft","mappingLeftKey","serviceMappings","deleteItem","editItem","fileName","formatDataService","mappingRightTitle","mappingLeftTitle","updateServiceMapping","receiveDataRows","deleteItems"],components:{ConfirmDialog:h.a,ServiceMappingForm:p,GridToolbar:y},data:function(){var e={deleteServiceMapping:"deleteServiceMapping"};return{deletionType:null,selectedItems:[],isDeletingItem:!1,selectedItem:null,editServiceMappingDialog:!1,dialog:o()({},e.deleteServiceMapping,!1),dialogNames:e,headers:[{text:this.mappingLeftTitle,align:"start",value:"serviceLeft"},{text:this.mappingRightTitle,align:"start",value:"serviceRight"},{text:"Actions",align:"start",value:"actions",sortable:!1}]}},computed:{items:function(){var e=this;return this.serviceMappings.map((function(t){return a()({},t,{serviceLeft:t[e.mappingLeftKey]&&t[e.mappingLeftKey].name||"-",serviceRight:t[e.mappingRightKey]&&t[e.mappingRightKey].name||"-"})}))}},methods:{openDialog:function(e,t,i){this.dialog[e]=!0,this.deletionType=t,"single"==t&&(this.selectedItem=i)},toggleServiceMappingDialog:function(e){this.editServiceMappingDialog=!this.editServiceMappingDialog,this.editServiceMappingDialog?this.selectedItem=e:this.selectedItem=null},closeDialog:function(e){this.dialog[e]=!1,this.selectedItem=null,this.deletionType=null},handleDeleteItem:function(){switch(this.deletionType){case"single":this.onDeleteRow();break;case"multiple":this.onDeleteRows()}},onCopy:function(e){var t=this.formatDataService(this.selectedItems,"copy");e(m()(t))},onDeleteRow:function(){var e=this;this.isDeletingItem=!0,this.deleteItem(this.selectedItem).then((function(){e.closeDialog(e.dialogNames.deleteServiceMapping)})).finally((function(){e.isDeletingItem=!1}))},onDeleteRows:function(){var e=this;this.selectedItems.length>0&&(this.isDeletingItem=!0,this.deleteItems(this.selectedItems).then((function(){e.closeDialog(e.dialogNames.deleteServiceMapping)})).finally((function(){e.isDeletingItem=!1})))}}},x=Object(u.a)(k,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-toolbar",{attrs:{flat:""}},[i("grid-toolbar",{attrs:{"on-copy":e.onCopy,items:e.items,toolbarTitle:"Mappings","file-name":e.fileName,"format-data-service":e.formatDataService,"receive-data-rows":e.receiveDataRows,"on-delete":function(){return e.openDialog(e.dialogNames.deleteServiceMapping,"multiple")}}})],1),e._v(" "),i("v-data-table",{attrs:{"show-select":"","item-key":"uuid",loading:e.loading,headers:e.headers,items:e.items,"footer-props":{showFirstLastPage:!0,firstIcon:"mdi-chevron-double-left",lastIcon:"mdi-chevron-double-right",prevIcon:"mdi-chevron-left",nextIcon:"mdi-chevron-right"}},scopedSlots:e._u([{key:"item.actions",fn:function(t){var n=t.item;return[i("v-btn",{staticClass:"white--text",attrs:{icon:"",small:"",color:"primary"},on:{click:function(){return e.toggleServiceMappingDialog(n)}}},[i("v-icon",{attrs:{small:"",dark:""}},[e._v(" mdi-pencil ")])],1),e._v(" "),i("v-btn",{staticClass:"white--text",attrs:{icon:"",small:"",color:"error"},on:{click:function(){return e.openDialog(e.dialogNames.deleteServiceMapping,"single",n)}}},[i("v-icon",{attrs:{small:"",dark:""}},[e._v(" mdi-delete ")])],1)]}}]),model:{value:e.selectedItems,callback:function(t){e.selectedItems=t},expression:"selectedItems"}}),e._v(" "),i("confirm-dialog",{attrs:{"is-open":e.dialog[e.dialogNames.deleteServiceMapping],loading:e.isDeletingItem,"on-close":function(){return e.closeDialog(e.dialogNames.deleteServiceMapping)},"on-confirm":function(){return e.handleDeleteItem()},"dialog-text":"Do you want to delete the mapping(s)?"}}),e._v(" "),i("v-dialog",{attrs:{"max-width":"500px"},model:{value:e.editServiceMappingDialog,callback:function(t){e.editServiceMappingDialog=t},expression:"editServiceMappingDialog"}},[i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[e._v("Edit Mapping")])]),e._v(" "),i("v-card-text",[i("service-mapping-form",{attrs:{"service-mappings":e.serviceMappings,"mapping-list-right":e.mappingListRight,"mapping-list-left":e.mappingListLeft,"mapping-selection-right-title":e.mappingLeftTitle,"mapping-selection-left-title":e.mappingRightTitle,"create-service-mapping":e.updateServiceMapping,"mapping-left-key":e.mappingLeftKey,"mapping-right-key":e.mappingRightKey,"is-edit-form":!0,"on-cancel":function(){return e.toggleServiceMappingDialog()},"service-mapping":e.selectedItem}})],1)],1)],1)],1)}),[],!1,null,null,null).exports,C=i("edSL"),D=i.n(C),w=i("OBCi"),S=i.n(w),I=i("uzYq"),N=i("mWu/"),L=i.n(N),G="/service-mapping/generic-bacnet-mapping";function R(e){return e.map((function(e){return{uuid:e.uuid,genericPoint:{id:e.generic_point_uuid,name:e.generic_point_name},bacnetPoint:{id:e.bacnet_point_uuid,name:e.bacnet_point_name}}}))}function T(e,t,i){return a()({},e,{network_details:t[e.generic_point_uuid],bacnet_point:i[e.bacnet_point_uuid]})}function F(e){return e.map((function(e){return L.a.unflatten(e,{transformKey:function(e){return e.trim()}})}))}function E(e){var t={};return e.uuid&&(t.uuid=e.uuid),a()({},t,{generic_point_uuid:e.genericPoint.id,generic_point_name:e.genericPoint.name,bacnet_point_uuid:e.bacnetPoint.id,bacnet_point_name:e.bacnetPoint.name})}var B,K=function(e){return I.a.delete(G+"/"+e.uuid)},A={name:"bacnet-generic-point-mapping-dialog",props:["dataRows","isOpen","close","bacnetPoints","genericPoints","syncMappingBacnetGenericPoints"],data:function(){return{valid:!1,isRequestOnce:!1,isCreatingMapping:!1,errors:[],rules:{required:function(e){return!!e||"Required."}},errorTableHeaders:[{text:"Row",value:"rowIndex",sortable:!1},{text:"Error Message",value:"message",sortable:!1}],headers:[{text:"Actions",value:"actions",sortable:!1},{text:"Row",value:"rowNumber",sortable:!1},{text:"Network Name",value:"networkName",sortable:!1},{text:"Device Name",value:"deviceName",sortable:!1},{text:"Point Name",value:"pointName",sortable:!1},{text:"Bacnet Point Name",value:"bacnetPointName",sortable:!1},{text:"Bacnet Point Address",value:"bacnetPointAddress",sortable:!1}]}},computed:{dataItems:function(){return this.dataRows},genericPointNames:function(){return this.genericPoints.map((function(e){return D()(e,"point.name")})).filter((function(e){return e}))}},methods:{exists:function(e,t,i){return!!t&&!!t.find((function(t){return i?t[i]==e:t==e}))},clickDeleteImport:function(e){this.dataRows=this.dataRows.filter((function(t,i){return i!==e})),this.errors=this.errors.filter((function(e,t){return itemIndex!==t}))},createMapping:function(){var e,t=this;this.$refs.form.validate()&&(this.isCreatingMapping=!0,this.isRequestOnce=!0,(e=this.dataItems,I.a.post(G+"/file-upload",F(e))).then((function(e){t.errors=e.reduce((function(e,i){return i.success||e.push(t.getErrorFromResult(i)),e}),[]),e.map((function(e){return e.success})).every((function(e){return e}))&&(t.syncMappingBacnetGenericPoints(),t.closeDialog())})).catch((function(e){})).finally((function(){t.isCreatingMapping=!1})))},getErrorFromResult:function(e){return{rowIndex:e.rowIndex+1,message:e.message}},closeDialog:function(){this.isRequestOnce&&this.syncMappingBacnetGenericPoints(),this.close()}}},$=Object(u.a)(A,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-dialog",{attrs:{persistent:""},model:{value:e.isOpen,callback:function(t){e.isOpen=t},expression:"isOpen"}},[i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[e._v("Import Mappings")])]),e._v(" "),i("v-card-text",[i("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[i("v-data-table",{staticClass:"elevation-1 mb-4",attrs:{headers:e.headers,items:e.dataItems,"footer-props":{showFirstLastPage:!0,firstIcon:"mdi-chevron-double-left",lastIcon:"mdi-chevron-double-right",prevIcon:"mdi-chevron-left",nextIcon:"mdi-chevron-right"}},scopedSlots:e._u([{key:"item.actions",fn:function(t){var n=t.item;return[i("v-icon",{attrs:{small:"",color:"error"},on:{click:function(t){return e.clickDeleteImport(n.index)}}},[e._v(" mdi-delete ")])]}},{key:"item.rowNumber",fn:function(t){t.item;var n=t.index;return[i("span",[e._v(e._s(+n+1))])]}},{key:"item.networkName",fn:function(t){var n=t.item;return[i("v-text-field",{staticStyle:{width:"100px"},attrs:{"single-line":"",required:""},model:{value:n.network_details.network.name,callback:function(t){e.$set(n.network_details.network,"name",t)},expression:"item.network_details.network.name"}})]}},{key:"item.deviceName",fn:function(t){var n=t.item;return[i("v-text-field",{staticStyle:{width:"100px"},attrs:{"single-line":"",required:""},model:{value:n.network_details.device.name,callback:function(t){e.$set(n.network_details.device,"name",t)},expression:"item.network_details.device.name"}})]}},{key:"item.pointName",fn:function(t){var n=t.item;return[i("v-text-field",{staticStyle:{width:"100px"},attrs:{"single-line":"",rules:[e.rules.required],required:""},model:{value:n.network_details.point.name,callback:function(t){e.$set(n.network_details.point,"name",t)},expression:"item.network_details.point.name"}})]}},{key:"item.bacnetPointName",fn:function(t){var n=t.item;return[i("v-text-field",{staticStyle:{width:"100px"},attrs:{rules:[e.rules.required],"single-line":"",required:""},model:{value:n.bacnet_point.name,callback:function(t){e.$set(n.bacnet_point,"name",t)},expression:"item.bacnet_point.name"}})]}},{key:"item.bacnetPointAddress",fn:function(t){var n=t.item;return[i("v-text-field",{staticStyle:{width:"100px"},attrs:{"single-line":"",required:"",rules:[e.rules.required]},model:{value:n.bacnet_point.address,callback:function(t){e.$set(n.bacnet_point,"address",t)},expression:"item.bacnet_point.address"}})]}}])})],1)],1),e._v(" "),e.errors.length>=1?i("v-card",{staticClass:"px-8 mt-n15"},[i("v-card-title",{attrs:{color:"red darken-1"}},[e._v("Errors")]),e._v(" "),i("v-card-text",[i("v-data-table",{staticClass:"elevation-1 mb-1",attrs:{"hide-default-footer":"",headers:e.errorTableHeaders,items:e.errors}})],1)],1):e._e(),e._v(" "),i("v-card-actions",[i("v-spacer"),e._v(" "),i("v-btn",{attrs:{color:"darken-1",text:""},on:{click:e.closeDialog}},[e._v(" Cancel ")]),e._v(" "),i("v-btn",{attrs:{color:"blue darken-1",loading:e.isCreatingMapping,text:""},on:{click:e.createMapping}},[e._v(" Save ")])],1)],1)],1)}),[],!1,null,null,null).exports,O=i("YfxP"),V=i("t3kO"),j=i.n(V),q=i("5u71"),H=i.n(q),J=i("yEOx"),z=i.n(J),U=function(e){var t=[],i=!0,n=!1,s=void 0;try{for(var r,o=j()(e);!(i=(r=o.next()).done);i=!0){var c=r.value,l=!0,d=!1,u=void 0;try{for(var p,v=j()(c.devices);!(l=(p=v.next()).done);l=!0){var m=p.value,h=!0,g=!1,f=void 0;try{for(var b,P=j()(m.points);!(h=(b=P.next()).done);h=!0){var _=b.value,M={id:_.uuid,uuid:_.uuid,name:c.name+":"+m.name+":"+_.name},y=a()({},c);delete y.devices;var k=a()({},m);delete k.points;var x=a()({},_);M=a()({},M,{network:y,device:k,point:x}),t.push(M)}}catch(e){g=!0,f=e}finally{try{!h&&P.return&&P.return()}finally{if(g)throw f}}}}catch(e){d=!0,u=e}finally{try{!l&&v.return&&v.return()}finally{if(d)throw u}}}}catch(e){n=!0,s=e}finally{try{!i&&o.return&&o.return()}finally{if(n)throw s}}return t},Q=function(e){var t=[],i=z()(e),n=!0,s=!1,r=void 0;try{for(var o,c=j()(e);!(n=(o=c.next()).done);n=!0){var l=o.value,d=!0,u=!1,p=void 0;try{for(var v,m=j()(l.devices);!(d=(v=m.next()).done);d=!0){var h=v.value,g=!0,f=!1,b=void 0;try{for(var P,_=j()(h.points);!(g=(P=_.next()).done);g=!0){var M=P.value,y={id:M.uuid,uuid:M.uuid,name:l.name+":"+h.name+":"+M.name},k=a()({},l);delete k.devices;var x=a()({},h);delete x.points;var C=a()({},M);y=a()({},y,{network:k,device:x,point:C}),t.push(y)}}catch(e){f=!0,b=e}finally{try{!g&&_.return&&_.return()}finally{if(f)throw b}}}}catch(e){u=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(u)throw p}}}}catch(e){s=!0,r=e}finally{try{!n&&c.return&&c.return()}finally{if(s)throw r}}return{networkPoints:t,networks:i}},W=function(e){var t=[],i=H()(e),n=!0,s=!1,r=void 0;try{for(var o,c=j()(e);!(n=(o=c.next()).done);n=!0){var l=o.value,d=!0,u=!1,p=void 0;try{for(var v,m=j()(l.devices);!(d=(v=m.next()).done);d=!0){var h=v.value,g={id:h.uuid,uuid:h.uuid,name:l.name+":"+h.name},f=a()({},l);delete f.devices;var b=a()({},h);g=a()({},g,{network:f,device:b}),t.push(g)}}catch(e){u=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(u)throw p}}}}catch(e){s=!0,r=e}finally{try{!n&&c.return&&c.return()}finally{if(s)throw r}}return{genericNetworks:i,genericDevices:t}},Y=function(e){var t=[],i=[],n=!0,s=!1,r=void 0;try{for(var o,c=j()(e);!(n=(o=c.next()).done);n=!0){var l=o.value;i.push(a()({},l));var d=!0,u=!1,p=void 0;try{for(var v,m=j()(l.points);!(d=(v=m.next()).done);d=!0){var h=v.value;t.push({item:h,deviceName:l.name,pointName:h.name,name:l.name+":"+h.name,id:h.uuid})}}catch(e){u=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(u)throw p}}}}catch(e){s=!0,r=e}finally{try{!n&&c.return&&c.return()}finally{if(s)throw r}}return{loraPoints:t,loraDevices:i}},X=function(){return I.a.get("/point-server/generic/network?with_children=true&points=true").then(U)},Z=function(){return I.a.get("/point-server/generic/network?with_children=true&points=true").then(W)},ee=function(){return I.a.get("/bac-net/point")},te=i("vQiG"),ie={name:"rubix-bacnet-points-mapping",components:{FullScreenContainer:O.a,ServiceMappingForm:p,ServiceMappingGrid:x,PageTitle:s.a,BacnetGenericPointMappingImportDialog:$},props:["on-cancel"],data:function(){return{openImportMappingDialog:!1,isUpdating:!1,dataRows:[],serviceMappings:[],rubixPSGenericPoints:[],bacnetPoints:[],isFetchingGridData:!1,rubixPSGenericPointsMap:{},bacnetPointsMap:{}}},mounted:function(){this.syncMappingBacnetGenericPoints()},methods:{syncMappingBacnetGenericPoints:function(){this.fetchServiceMapping(),this.fetchBacnetPoints(),this.fetchGenericPoints()},fetchBacnetPoints:function(){var e=this;ee().then((function(t){e.bacnetPoints=t.map((function(e){return a()({},e,{id:e.uuid,name:e.object_name})})),e.bacnetPointsMap=(e.bacnetPoints||[]).reduce((function(e,t){return e[t.uuid]=t,e}),{})}))},fetchGenericPoints:function(){var e=this;X().then((function(t){e.rubixPSGenericPoints=t,e.rubixPSGenericPointsMap=(e.rubixPSGenericPoints||[]).reduce((function(e,t){return e[t.id]=t,e}),{})}))},createServiceMapping:function(e){var t=this;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return I.a.post(""+G,E(e))}(e).then((function(){t.fetchServiceMapping(),t.$toasted.show(te.c.success)})).catch((function(e){t.$toasted.show(te.c.error,{type:"error"})})).finally((function(){}))},updateServiceMapping:function(e,t){var i=this;return function(){var e=arguments[1],t=E(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return I.a.patch(G+"/"+e,t)}(e,t).then((function(){i.fetchServiceMapping(),i.$toasted.show(te.g.success)})).catch((function(e){i.$toasted.show(te.g.error,{type:"error"})}))},fetchServiceMapping:function(){var e=this;this.isFetchingGridData=!0,I.a.get(""+G).then(R).then((function(t){e.serviceMappings=t})).finally((function(){e.isFetchingGridData=!1}))},deleteServiceMapping:function(e){var t=this;return K(e).then((function(){t.fetchServiceMapping(),t.$toasted.show(te.d.success)})).catch((function(e){t.$toasted.show(te.d.error,{type:"error"}),console.error(e)}))},deleteServiceMappings:function(e){var t=this;return function(e){return S.a.all(e.map((function(e){return K(e)})))}(e).then((function(){t.fetchServiceMapping(),t.$toasted.show(te.e.success)})).catch((function(e){t.$toasted.show(te.e.error,{type:"error"})}))},formatExportData:function(e,t){var i=this;return"copy"===t?e.map(E).map((function(e){return T(e,i.rubixPSGenericPointsMap,i.bacnetPointsMap)})):function(e){return e.map((function(e){return L.a.flatten(e)}))}(e.map(E).map((function(e){return T(e,i.rubixPSGenericPointsMap,i.bacnetPointsMap)})))},closeImportMappingDialog:function(){this.openImportMappingDialog=!1},receiveDataRows:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.length>=1&&(this.dataRows=F(e),this.openImportMappingDialog=!0)}}},ne=Object(u.a)(ie,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-card-text",[i("v-spacer"),e._v(" "),i("service-mapping-form",{attrs:{"service-mappings":e.serviceMappings,"mapping-list-right":e.rubixPSGenericPoints,"mapping-list-left":e.bacnetPoints,"mapping-selection-right-title":"Rubix Rubix Points","mapping-selection-left-title":"BACnet Points","create-service-mapping":e.createServiceMapping,"mapping-left-key":"bacnetPoint","mapping-right-key":"genericPoint"}}),e._v(" "),i("v-divider"),e._v(" "),i("service-mapping-grid",{attrs:{"mapping-right-key":"bacnetPoint","mapping-left-key":"genericPoint","format-data-service":e.formatExportData,"file-name":"bacnet-points-generic-points-mapping","mapping-left-title":"Rubix Rubix Points","mapping-right-title":"BACnet Points","mapping-list-left":e.rubixPSGenericPoints,"mapping-list-right":e.bacnetPoints,"delete-item":e.deleteServiceMapping,"delete-items":e.deleteServiceMappings,loading:e.isFetchingGridData,"update-service-mapping":e.updateServiceMapping,"service-mappings":e.serviceMappings,"receive-data-rows":e.receiveDataRows}}),e._v(" "),i("bacnet-generic-point-mapping-import-dialog",{attrs:{"bacnet-points":e.bacnetPoints,"generic-points":e.rubixPSGenericPoints,"is-open":e.openImportMappingDialog,close:e.closeImportMappingDialog,"sync-mapping-bacnet-generic-points":e.syncMappingBacnetGenericPoints,"data-rows":e.dataRows}})],1)}),[],!1,null,null,null).exports,ae=i("snOE"),se=i.n(ae),re=i("tZmG"),oe=i.n(re),ce=i("tXyU"),le=i.n(ce),de=i("/gfI"),ue=i.n(de),pe=(B={components:{RbxButton:c.a},props:["serviceMappings","isEditForm","parentPoints","child1Points","child2Points","serviceMapping","parentMappingKey","child1MappingKey","child2MappingKey","createServiceMapping","createLoraBacnetGenericPointMapping","parentFieldTitle","child1FieldTitle","child2FieldTitle","onCancel","genericNetworkDevices","loraDevices","genericNetworks"],data:function(){return{uuid:null,valid:!1,mappingErrors:[],loraDeviceNames:[],loraDeviceStates:{},autoCreateDevicesAndPoints:!1,autoCreateBacnetPoints:!1,selectedLoraDevices:[],addNewNetworkToggle:!1,addNewDeviceToggle:!1,isMapMultipleLoraPoints:!1,isMapExistingBacnetPoint:!0,isCreatingMapping:!1,selectedLoraPoint:null,selectedLoraPoints:[],selectedChild1Point:null,selectedChild2Point:null,selectedGenericNetwork:null,selectedGenericDevice:null,genericPointValidation:[l.a.required],genericChildValidation:[l.a.required],fieldValidations:[l.a.required],generatedGenericPoints:[],generatedBacnetPoints:[],arrayRequiredValidation:function(e){return!!(Array.isArray(e)&&e.length>0)||"Required"}}},watch:{selectedLoraPoints:function(e,t){this.onGenericDevicesChange(),this.isMultipleLoraPointsSelected&&(this.selectedChild1Point=null,this.isMapMultipleLoraPoints=!1)}}},o()(B,"watch",{loraDeviceNames:function(e,t){ue()(e,t)||(this.loraDeviceStates=this.loraDeviceNames.reduce((function(e,t){return e[t]={name:t,selected:!1},e}),{}))}}),o()(B,"mounted",(function(){this.isEditForm&&this.serviceMapping&&(this.uuid=this.serviceMapping.uuid,this.isMapMultipleLoraPoints=!0,this.selectedLoraPoint=this.serviceMapping[this.parentMappingKey],this.serviceMapping.hasOwnProperty(this.child1MappingKey)&&(this.selectedChild1Point=this.serviceMapping[this.child1MappingKey]),this.serviceMapping.hasOwnProperty(this.child2MappingKey)&&(this.selectedChild2Point=this.serviceMapping[this.child2MappingKey]),this.genericChildValidation=[])})),o()(B,"computed",{mappings:function(){return this.serviceMappings},selectedParentMappings:function(){var e=this;return this.serviceMappings.map((function(t){return t[e.parentMappingKey]}))},selectedChild2Mappings:function(){var e=this;return this.serviceMappings.map((function(t){return t[e.child2MappingKey]}))},selectedChild1Mappings:function(){var e=this;return this.serviceMappings.map((function(t){return t[e.child1MappingKey]}))},updatedParentPointsList:function(){return this.selectedLoraDevices,this.updateParentListItemProperty(this.parentPoints,this.selectedParentMappings)},updatedChild2PointsList:function(){return this.updateLisItemProperty(this.child2Points,this.selectedChild2Mappings)},updatedChild1PointsList:function(){return this.updateLisItemProperty(this.child1Points,this.selectedChild1Mappings)},isAllLoraPointsSelected:function(){return this.selectedLoraPoints.length===this.updatedParentPointsList.length},isMultipleLoraPointsSelected:function(){return this.selectedLoraPoints&&this.selectedLoraPoints.length>1},deviceSelectAllOptions:function(){return this.loraDevices.map((function(e){return{name:e.name,value:e.name,uuid:e.uuid,item:e,selected:!1}}))},genericDevices:function(){return this.selectedGenericNetwork&&this.selectedGenericNetwork.devices||[]},loraSelectionLabel:function(){return this.selectedLoraPoints.length>0?this.parentFieldTitle+" | "+this.selectedLoraPoints.length+" LoRa points selected":this.parentFieldTitle}}),o()(B,"methods",{getServiceMappings:function(){return this.autoCreateBacnetPoints?this.generatedBacnetPoints.map((function(e){return{bacnet_point:e.bacnetPoint,lora_point:e.loraPoint.item}})):this.autoCreateDevicesAndPoints?this.generatedGenericPoints.map((function(e){return{generic_point:{network:e.network,device:e.device,point:e.point},lora_point:e.loraPoint.item}})):void 0},addMapping:function(){var e,t=this;if(this.$refs.mappingForm.validate()){if(this.mappingErrors=[],!this.isEditForm&&!this.isMapMultipleLoraPoints&&(this.autoCreateDevicesAndPoints||this.autoCreateBacnetPoints)){this.isCreatingMapping=!0;var i=this.getServiceMappings();return this.createLoraBacnetGenericPointMapping(i,this.autoCreateDevicesAndPoints,this.autoCreateBacnetPoints).then((function(e){e.every((function(e){return!e.success}))?t.extractDisplayError(e):(t.selectedLoraPoints=null,t.selectedLoraPoint=null,t.selectedChild2Point=null,t.selectedChild1Point=null,t.autoCreateDevicesAndPoints=!1,t.autoCreateBacnetPoints=!1,t.selectedLoraDevices=[],t.$refs.mappingForm.reset())})).catch((function(e){})).finally((function(){t.isCreatingMapping=!1}))}this.isEditForm||1!=this.selectedLoraPoints.length||(this.selectedLoraPoint=this.selectedLoraPoints[0].item),this.isCreatingMapping=!0,this.createServiceMapping((e={},o()(e,this.parentMappingKey,this.selectedLoraPoint),o()(e,this.child1MappingKey,this.selectedChild1Point),o()(e,this.child2MappingKey,this.selectedChild2Point),e),this.uuid).then((function(){if(t.isEditForm)return t.onCancel();t.selectedLoraPoints=null,t.selectedLoraPoint=null,t.selectedChild2Point=null,t.selectedChild1Point=null,t.$refs.mappingForm.reset()})).finally((function(){t.isCreatingMapping=!1}))}},extractDisplayError:function(e){var t=e.filter((function(e){return!e.success})).map((function(e){return{lora_point_name:e.data&&e.data.lora_point_name,child_point_name:e.data&&(e.data.generic_point_name||e.data.bacnet_point_name),message:e.message,index:e.rowIndex}}));this.mappingErrors=t},updateParentListItemProperty:function(e,t){if(!t)return e;var i=t.filter((function(e){return e})).map((function(e){return e.id})),n=e.reduce((function(e,t){return i.includes(t.id)?t.disabled=!0:t.disabled=!1,t.group=t.deviceName,e.push(t),e}),[]),a=le()(n,(function(e){return e.group})),s=oe()(a).reduce((function(e,t){var i={text:t,name:t,isHeader:!0,isNonItem:!0};return e.push(i),e.push.apply(e,se()(a[t])),e.push({divider:!0,isNonItem:!0}),e}),[]);return this.loraDeviceNames=oe()(a),s},updateLisItemProperty:function(e,t){if(!t)return e;var i=t.filter((function(e){return e})).map((function(e){return e.id}));return e.reduce((function(e,t){return i.includes(t.id)?t.disabled=!0:t.disabled=!1,e.push(t),e}),[])},checkValidation:function(){(this.selectedChild1Point||this.selectedChild2Point||this.selectedGenericDevice||this.autoCreateDevicesAndPoints||this.autoCreateBacnetPoints)&&this.genericChildValidation.pop(),this.selectedChild1Point||this.selectedChild2Point||this.selectedGenericDevice||this.autoCreateDevicesAndPoints||this.autoCreateBacnetPoints||!(this.genericChildValidation.length<1)||this.genericChildValidation.push(l.a.required),this.$refs.mappingForm.resetValidation()},onLoraPointsSelectToggle:function(){var e=this;this.$nextTick((function(){e.isMultipleLoraPointsSelected?e.selectedLoraPoints=[]:e.selectedLoraPoints=e.updatedParentPointsList.slice().filter((function(e){return!e.disabled&&!e.isHeader&&!e.isNonItem}))}))},onGenericDevicesChange:function(){var e=this;Array.isArray(this.selectedLoraPoints)&&this.selectedLoraPoints.length>0&&this.selectedGenericDevice?this.generatedGenericPoints=this.selectedLoraPoints.reduce((function(t,i){var n={};return n.network=e.selectedGenericNetwork,n.device=e.selectedGenericDevice,n.point=i.item,n.name=n.network.name+":"+n.device.name+":"+n.point.name,n.loraPoint=i,t.push(n),t}),[]):this.generatedGenericPoints=[],this.checkValidation()},onMapExistingChange:function(){this.selectedChild2Point=null,this.genericChildValidation.length<1&&this.genericChildValidation.push(l.a.required),this.generatedGenericPoints=[]},onDeviceSelectAllClick:function(e){var t=this;this.$nextTick((function(){t.loraDeviceStates[e].selected=!t.loraDeviceStates[e].selected,t.loraDeviceStates[e].selected?t.selectedLoraDevices.push(e):t.selectedLoraDevices=t.selectedLoraDevices.filter((function(t){return t!==e})),t.selectedLoraPoints=t.updatedParentPointsList.reduce((function(e,i){return t.selectedLoraDevices.indexOf(i.deviceName)>-1&&!i.disabled?(e.push(i),e):e}),[])}))},getGenericDevice:function(e,t){return{driver:"GENERIC",enable:!1,fault:null,history_enable:!1,name:t,network_uuid:e}},getBacnetPoint:function(e,t){return{object_type:"analogOutput",object_name:"bacnet_"+t+"-"+e,address:null,relinquish_default:1,priority_array_write:{_1:null,_2:null,_3:null,_4:null,_5:null,_6:null,_7:null,_8:null,_9:null,_10:null,_11:null,_12:null,_13:null,_14:null,_15:null,_16:null},event_state:"lowLimit",units:"volts",description:"description",enable:!0,use_next_available_address:!0}},onAutoCreateToggle:function(){var e=this;this.autoCreateDevicesAndPoints&&(this.autoCreateBacnetPoints=!1,this.generatedBacnetPoints=[]),this.autoCreateDevicesAndPoints&&this.selectedGenericNetwork?(this.selectedGenericDevice=null,this.generatedGenericPoints=this.selectedLoraPoints.reduce((function(t,i){var n={};return n.network=e.selectedGenericNetwork,n.device=e.getGenericDevice(n.network.uuid,i.deviceName),n.point=i.item,n.name=n.network.name+":"+n.device.name+":"+n.point.name,n.loraPoint=i,t.push(n),t}),[])):this.generatedGenericPoints=[],this.checkValidation()},onAutoBacnetCreateToggle:function(){var e=this;this.autoCreateBacnetPoints&&(this.autoCreateDevicesAndPoints=!1,this.generatedGenericPoints=[]),this.autoCreateBacnetPoints?(this.selectedChild1Point=null,this.generatedBacnetPoints=this.selectedLoraPoints.reduce((function(t,i){var n={};return n.loraPoint=i,n.bacnetPoint=e.getBacnetPoint(i.item.device_point_name,i.item.name),n.name=n.bacnetPoint.object_name,t.push(n),t}),[])):this.generatedBacnetPoints=[],this.checkValidation()},onLoraPointsSelectionClear:function(){this.selectedLoraDevices=[]}}),B),ve=Object(u.a)(pe,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-form",{ref:"mappingForm",class:e.isEditForm?"":"mb-4",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[i("v-row",{attrs:{dense:""}},[i("v-col",{attrs:{cols:12}},[e.isEditForm?i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"id","item-text":"name","auto-select-first":"",rules:e.fieldValidations,label:e.parentFieldTitle,items:e.updatedParentPointsList},model:{value:e.selectedLoraPoint,callback:function(t){e.selectedLoraPoint=t},expression:"selectedLoraPoint"}}):e._e(),e._v(" "),e.isEditForm?e._e():i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"id","item-text":"name","auto-select-first":"",rules:[e.arrayRequiredValidation],label:e.loraSelectionLabel,items:e.updatedParentPointsList,multiple:""},on:{"click:clear":e.onLoraPointsSelectionClear},scopedSlots:e._u([{key:"item",fn:function(t){var n=t.item,a=t.attrs;return[n.isHeader?[i("v-list-item",{attrs:{ripple:""},on:{click:function(t){return e.onDeviceSelectAllClick(n.name)}}},[i("v-icon",{staticClass:"mr-2"},[e._v("\n                "+e._s(e.selectedLoraDevices.indexOf(n.name)>-1?"mdi-close-box":"mdi-checkbox-blank-outline")+"\n              ")]),e._v(" "),i("v-list-item-title",[i("span",{staticClass:"caption"},[e._v("Select all lora points of")]),e._v(" "),i("strong",[e._v(e._s(n.name+" "))]),e._v(" "),i("span",{staticClass:"caption"},[e._v("device")])])],1)]:[i("v-list-item-content",{staticClass:"ml-5"},[i("v-list-item-title",[n.disabled?e._e():i("v-icon",{staticClass:"mr-2"},[e._v("\n                  "+e._s("true"==a["aria-selected"]?"mdi-checkbox-marked":"mdi-checkbox-blank-outline")+"\n                ")]),e._v(" "),i("span",{staticClass:"caption"},[e._v(e._s(n.deviceName))]),e._v(" "),i("strong",[e._v(e._s(n.pointName))]),e._v(" "),n.disabled?i("span",{staticClass:"already-mapped-label"},[e._v(" Already Mapped ")]):e._e()],1)],1)]]}},{key:"prepend-item",fn:function(){return[i("v-list-item",{attrs:{ripple:""},on:{click:e.onLoraPointsSelectToggle}},[i("v-icon",{staticClass:"mr-2"},[e._v("\n              "+e._s(e.isMultipleLoraPointsSelected?"mdi-close-box":"mdi-checkbox-blank-outline")+"\n            ")]),e._v(" "),i("v-list-item-content",[i("v-list-item-title",[e._v(" Select all ")])],1)],1),e._v(" "),i("v-divider",{staticClass:"mt-2"})]},proxy:!0}],null,!1,988508271),model:{value:e.selectedLoraPoints,callback:function(t){e.selectedLoraPoints=t},expression:"selectedLoraPoints"}})],1),e._v(" "),i("v-col",{attrs:{cols:"12"}},[i("v-row",{attrs:{dense:""}},[i("v-col",{attrs:{cols:"6"}},[i("v-switch",{staticClass:"pr-4",attrs:{inset:"",label:"Auto create new bacnet point(s) and mapping(s)",color:"primary"},on:{change:e.onAutoBacnetCreateToggle},model:{value:e.autoCreateBacnetPoints,callback:function(t){e.autoCreateBacnetPoints=t},expression:"autoCreateBacnetPoints"}})],1),e._v(" "),i("v-col",{attrs:{cols:"6"}},[i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"id","item-text":"name","auto-select-first":"",label:e.child1FieldTitle,rules:e.genericChildValidation,items:e.updatedChild1PointsList,disabled:!!e.selectedChild2Point||e.isMultipleLoraPointsSelected},on:{change:e.checkValidation},model:{value:e.selectedChild1Point,callback:function(t){e.selectedChild1Point=t},expression:"selectedChild1Point"}})],1)],1)],1),e._v(" "),!e.isMapMultipleLoraPoints&&e.generatedBacnetPoints.length>0?i("v-col",{attrs:{cols:"12"}},[i("v-item-group",{staticClass:"text-left",attrs:{multiple:""}},[i("v-subheader",[e._v("Generated Bacnet Points")]),e._v(" "),e._l(e.generatedBacnetPoints,(function(t){return i("v-item",{key:t.name,staticClass:"ml-2 mb-2"},[i("v-chip",{attrs:{"active-class":"green--text",value:t}},[e._v("\n            "+e._s(t.name)+"\n          ")])],1)}))],2)],1):e._e(),e._v(" "),i("v-col",{attrs:{cols:"12"}},[i("v-row",{attrs:{dense:""}},[e.isMapMultipleLoraPoints?e._e():i("div",{staticClass:"existing-generic-mapping-wrapper"},[i("v-row",{attrs:{dense:""}},[i("v-col",{attrs:{cols:"12"}},[i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"uuid",disabled:!(e.selectedLoraPoints&&e.selectedLoraPoints.length>0),"item-text":"name","auto-select-first":"",rules:e.genericChildValidation,label:"Select Existing Generic Network",items:e.genericNetworks},on:{change:e.onAutoCreateToggle},model:{value:e.selectedGenericNetwork,callback:function(t){e.selectedGenericNetwork=t},expression:"selectedGenericNetwork"}})],1)],1),e._v(" "),i("v-row",{attrs:{dense:""}},[i("v-col",{attrs:{cols:"6"}},[i("v-switch",{staticClass:"pr-4",attrs:{inset:"",label:"Auto create new device(s), point(s) and mapping(s)",color:"primary"},on:{change:e.onAutoCreateToggle},model:{value:e.autoCreateDevicesAndPoints,callback:function(t){e.autoCreateDevicesAndPoints=t},expression:"autoCreateDevicesAndPoints"}})],1),e._v(" "),i("v-col",{attrs:{cols:"6"}},[e.autoCreateDevicesAndPoints?e._e():i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"uuid",disabled:!(e.selectedLoraPoints&&e.selectedLoraPoints.length>0),"item-text":"name","auto-select-first":"",rules:e.genericChildValidation,label:"Select Existing Generic Device",items:e.genericDevices},on:{change:e.onGenericDevicesChange},model:{value:e.selectedGenericDevice,callback:function(t){e.selectedGenericDevice=t},expression:"selectedGenericDevice"}})],1)],1)],1),e._v(" "),e.isMapMultipleLoraPoints?i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"id","item-text":"name","auto-select-first":"",label:e.child2FieldTitle,rules:e.genericChildValidation,disabled:!!e.selectedChild1Point,items:e.updatedChild2PointsList},on:{change:e.checkValidation},model:{value:e.selectedChild2Point,callback:function(t){e.selectedChild2Point=t},expression:"selectedChild2Point"}}):e._e()],1)],1),e._v(" "),!e.isMapMultipleLoraPoints&&e.generatedGenericPoints.length>0?i("v-col",{attrs:{cols:"12"}},[i("v-item-group",{staticClass:"text-left",attrs:{multiple:""}},[i("v-subheader",[e._v("Generated Generic Points")]),e._v(" "),e._l(e.generatedGenericPoints,(function(t){return i("v-item",{key:t.name,staticClass:"ml-2 mb-2"},[i("v-chip",{attrs:{"active-class":"green--text",value:t}},[e._v("\n            "+e._s(t.name)+"\n          ")])],1)}))],2)],1):e._e(),e._v(" "),i("v-col",{attrs:{cols:"12"}},e._l(e.mappingErrors,(function(t){return i("v-alert",{key:t.index,attrs:{dense:"",outlined:"",type:"warning"}},[e._v("\n        Mapping Error: "),i("strong",{staticClass:"white--text"},[e._v(e._s(t.lora_point_name))]),e._v(" --\n        "),i("strong",{staticClass:"white--text"},[e._v(e._s(t.child_point_name))]),e._v(" |\n        "),i("span",[e._v(e._s(t.message))])])})),1),e._v(" "),e.isEditForm?e._e():i("v-col",{staticClass:"flex justify-center align-center",attrs:{cols:"2"}},[i("rbx-button",{attrs:{loading:e.isCreatingMapping,block:!0,color:"pink",click:e.addMapping,title:"Add"}})],1)],1),e._v(" "),e.isEditForm?i("v-card-actions",[i("v-spacer"),e._v(" "),i("v-btn",{attrs:{color:"darken-1",text:""},on:{click:e.onCancel}},[e._v(" Cancel ")]),e._v(" "),i("v-btn",{attrs:{color:"blue darken-1",loading:e.isCreatingMapping,text:""},on:{click:e.addMapping}},[e._v(" Save ")])],1):e._e()],1)}),[],!1,null,"d5e97fea",null).exports,me={name:"service-mapping-grid",components:{ConfirmDialog:h.a,GridToolbar:y,LoraGenericBacnetPointMappingForm:ve},props:["loading","parentMappingKey","child1MappingKey","child2MappingKey","serviceMappings","parentPoints","child1Points","child2Points","updateServiceMapping","deleteItem","deleteItems","parentHeaderTitle","child1HeaderTitle","child2HeaderTitle","fileName","receiveDataRows","formatDataService"],data:function(){return{search:"",deleteServiceMappingDialog:!1,isDeletingItem:!1,selectedItem:null,selectedItems:[],deletionType:null,editServiceMappingDialog:!1,headers:[{text:this.parentHeaderTitle,align:"start",value:"parentName"},{text:this.child1HeaderTitle,align:"start",value:"child1Name"},{text:this.child2HeaderTitle,align:"start",value:"child2Name"},{text:"Actions",align:"start",value:"actions",sortable:!1}]}},computed:{items:function(){var e=this;return this.serviceMappings.map((function(t){return a()({},t,{parentName:t[e.parentMappingKey].name,child1Name:t[e.child1MappingKey]&&t[e.child1MappingKey].name||"-",child2Name:t[e.child2MappingKey]&&t[e.child2MappingKey].name||"-"})}))},isDeleteEnabled:function(){return this.selectedItems.length>0}},methods:{toggleDeleteDialog:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.deletionType=t,this.deleteServiceMappingDialog=!this.deleteServiceMappingDialog,e&&this.deleteServiceMappingDialog?this.selectedItem=e:this.selectedItem=null},toggleServiceMappingDialog:function(e){this.editServiceMappingDialog=!this.editServiceMappingDialog,this.editServiceMappingDialog?this.selectedItem=e:this.selectedItem=null},closeDeleteDialog:function(){this.deleteServiceMappingDialog=!1,this.selectedItem=null,this.deletionType=null},handleDeleteItem:function(){switch(this.deletionType){case"single":this.onDeleteRow();break;case"multiple":this.onDeleteRows()}},onDeleteRows:function(){var e=this;this.selectedItems.length>0&&(this.isDeletingItem=!0,this.deleteItems(this.selectedItems).then((function(){e.closeDeleteDialog()})).finally((function(){e.isDeletingItem=!1})))},onDeleteRow:function(){var e=this;this.isDeletingItem=!0,this.deleteItem(this.selectedItem).then((function(){e.closeDeleteDialog()})).finally((function(){e.isDeletingItem=!1}))},onCopy:function(e){var t=this.formatDataService(this.selectedItems);e(m()(t))}}},he=Object(u.a)(me,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("grid-toolbar",{attrs:{"on-copy":e.onCopy,items:e.items,toolbarTitle:"Mappings","file-name":e.fileName,"format-data-service":e.formatDataService,"receive-data-rows":e.receiveDataRows,"is-delete-enabled":e.isDeleteEnabled,"on-delete":function(){return e.toggleDeleteDialog(null,"multiple")}},scopedSlots:e._u([{key:"search",fn:function(){return[i("v-text-field",{staticClass:"pl-10",attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]},proxy:!0}])}),e._v(" "),i("v-data-table",{attrs:{"item-key":"uuid","show-select":"",loading:e.loading,headers:e.headers,items:e.items,search:e.search,"footer-props":{showFirstLastPage:!0,firstIcon:"mdi-chevron-double-left",lastIcon:"mdi-chevron-double-right",prevIcon:"mdi-chevron-left",nextIcon:"mdi-chevron-right"}},scopedSlots:e._u([{key:"item.actions",fn:function(t){var n=t.item;return[i("v-btn",{staticClass:"white--text",attrs:{icon:"",small:"",color:"primary"},on:{click:function(){return e.toggleServiceMappingDialog(n)}}},[i("v-icon",{attrs:{small:"",dark:""}},[e._v(" mdi-pencil ")])],1),e._v(" "),i("v-btn",{staticClass:"white--text",attrs:{icon:"",small:"",color:"error"},on:{click:function(){return e.toggleDeleteDialog(n,"single")}}},[i("v-icon",{attrs:{small:"",dark:""}},[e._v(" mdi-delete ")])],1)]}}]),model:{value:e.selectedItems,callback:function(t){e.selectedItems=t},expression:"selectedItems"}}),e._v(" "),i("confirm-dialog",{attrs:{"is-open":e.deleteServiceMappingDialog,loading:e.isDeletingItem,"on-close":function(){return e.closeDeleteDialog()},"on-confirm":function(){return e.handleDeleteItem()},"dialog-text":"Do you want to delete the mapping?"}}),e._v(" "),i("v-dialog",{attrs:{"max-width":"500px"},model:{value:e.editServiceMappingDialog,callback:function(t){e.editServiceMappingDialog=t},expression:"editServiceMappingDialog"}},[i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[e._v("Edit Mapping")])]),e._v(" "),i("v-card-text",[i("lora-generic-bacnet-point-mapping-form",{attrs:{"is-edit-form":!0,"on-cancel":function(){return e.toggleServiceMappingDialog()},"service-mapping":e.selectedItem,parentPoints:e.parentPoints,child1Points:e.child1Points,child2Points:e.child2Points,parentMappingKey:e.parentMappingKey,child1MappingKey:e.child1MappingKey,child2MappingKey:e.child2MappingKey,parentFieldTitle:e.parentHeaderTitle,child1FieldTitle:e.child1HeaderTitle,child2FieldTitle:e.child2HeaderTitle,serviceMappings:e.serviceMappings,createServiceMapping:e.updateServiceMapping}})],1)],1)],1)],1)}),[],!1,null,null,null).exports,ge=i("NWgQ"),fe=i.n(ge),be="/service-mapping/lora-generic-bacnet-mapping";function Pe(e){return e.map((function(e){var t={};return e.generic_point_uuid&&(t={genericPoint:{id:e.generic_point_uuid,name:e.generic_point_name}}),e.bacnet_point_uuid&&(t=a()({},t,{bacnetPoint:{id:e.bacnet_point_uuid,name:e.bacnet_point_name}})),a()({},t,{uuid:e.uuid,loraPoint:{id:e.lora_point_uuid,name:e.lora_point_name}})}))}function _e(e){var t={};return e.bacnetPoint&&e.bacnetPoint.id&&(t={bacnet_point_uuid:e.bacnetPoint.id,bacnet_point_name:e.bacnetPoint.name}),e.genericPoint&&e.genericPoint.id&&(t=a()({},t,{generic_point_uuid:e.genericPoint.id,generic_point_name:e.genericPoint.name})),e.uuid&&(t=a()({},t,{uuid:e.uuid})),a()({},t,{lora_point_uuid:e.loraPoint.id||e.loraPoint.uuid,lora_point_name:e.loraPoint.name})}var Me,ye=function(e){return I.a.delete(be+"/"+e.uuid)},ke={name:"lora-generic-bacnet-points-mapping",components:{LoraGenericBacnetPointMappingForm:ve,LoraGenericBacnetPointMappingGrid:he},data:function(){return{isUpdating:!1,serviceMappings:[],genericPoints:[],bacnetPoints:[],loraPoints:[],loraDevices:[],genericNetworks:[],genericNetworkDevices:[],isFetchingGridData:!1}},mounted:function(){var e=this;this.fetchServiceMapping(),Z().then((function(t){var i=t.genericNetworks,n=t.genericDevices;e.genericNetworks=i,e.genericNetworkDevices=n})).catch((function(e){})),X().then((function(t){e.genericPoints=t})).catch((function(e){})),ee().then((function(t){e.bacnetPoints=t.map((function(e){return{id:e.uuid,name:e.object_name}}))})).catch((function(e){})),I.a.get("/lora/device").then(Y).then((function(t){var i=t.loraPoints,n=t.loraDevices;e.loraPoints=i,e.loraDevices=n})).catch((function(e){}))},methods:{fetchServiceMapping:function(){var e=this;return this.isFetchingGridData=!0,I.a.get(""+be).then(Pe).then((function(t){e.serviceMappings=t})).finally((function(){e.isFetchingGridData=!1}))},createServiceMapping:function(e){var t=this;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return I.a.post(""+be,_e(e))}(e).then((function(){t.fetchServiceMapping(),t.$toasted.show(te.c.success)})).catch((function(e){t.$toasted.show(te.c.error,{type:"error"})})).finally((function(){}))},updateServiceMapping:function(e,t){var i=this;return function(){var e=arguments[1],t=_e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return I.a.patch(be+"/"+e,t)}(e,t).then((function(){i.fetchServiceMapping(),i.$toasted.show(te.g.success)})).catch((function(e){i.$toasted.show(te.g.error,{type:"error"})}))},deleteServiceMappings:function(e){var t=this;return function(e){return S.a.all(e.map((function(e){return ye(e)})))}(e).then((function(){t.fetchServiceMapping(),t.$toasted.show(te.e.success)})).catch((function(e){t.$toasted.show(te.e.error,{type:"error"})}))},deleteServiceMapping:function(e){var t=this;return ye(e).then((function(){t.fetchServiceMapping(),t.$toasted.show(te.d.success)})).catch((function(e){t.$toasted.show(te.d.error,{type:"error"}),console.error(e)}))},formatExportData:function(e){return e},createLoraBacnetGenericPointMapping:function(e,t,i){var n=this;return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return I.a.post(be+"/bulk-service-mapping?"+fe.a.stringify(t),e)}(e,{autoCreateDevice:t,autoCreateBacnetPoints:i}).then((function(e){return n.fetchServiceMapping(),e}))}}},xe=Object(u.a)(ke,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-card-text",[i("lora-generic-bacnet-point-mapping-form",{attrs:{serviceMappings:e.serviceMappings,parentPoints:e.loraPoints,child1Points:e.bacnetPoints,child2Points:e.genericPoints,"lora-devices":e.loraDevices,genericNetworkDevices:e.genericNetworkDevices,genericNetworks:e.genericNetworks,parentMappingKey:"loraPoint",child1MappingKey:"bacnetPoint",child2MappingKey:"genericPoint",createServiceMapping:e.createServiceMapping,createLoraBacnetGenericPointMapping:e.createLoraBacnetGenericPointMapping,parentFieldTitle:"LoRa Points",child1FieldTitle:"BACnet Points",child2FieldTitle:"Rubix Points"}}),e._v(" "),i("v-divider"),e._v(" "),i("lora-generic-bacnet-point-mapping-grid",{attrs:{loading:e.isFetchingGridData,"file-name":"lora-bacnet-generic-service-mapping","format-data-service":e.formatExportData,parentPoints:e.loraPoints,child1Points:e.bacnetPoints,child2Points:e.genericPoints,parentMappingKey:"loraPoint",child1MappingKey:"bacnetPoint",child2MappingKey:"genericPoint",serviceMappings:e.serviceMappings,deleteItem:e.deleteServiceMapping,deleteItems:e.deleteServiceMappings,parentHeaderTitle:"LoRa Points",child1HeaderTitle:"BACnet Points",child2HeaderTitle:"Rubix Points",updateServiceMapping:e.updateServiceMapping}})],1)}),[],!1,null,null,null).exports,Ce=(Me={components:{RbxButton:c.a},props:["serviceMappings","isEditForm","parentPoints","child1Points","child2Points","serviceMapping","parentMappingKey","child1MappingKey","child2MappingKey","createServiceMapping","createModbusBacnetGenericPointMapping","parentFieldTitle","child1FieldTitle","child2FieldTitle","onCancel","genericNetworkDevices","genericNetworks","modbusNetworks"],data:function(){return{uuid:null,valid:!1,mappingErrors:[],modbusDeviceNames:[],modbusNetworkNames:[],modbusDeviceSelectionStates:{},modbusNetworkSelectionStates:{},autoCreateDevicesAndPoints:!1,autoCreateBacnetPoints:!1,selectedModbusDevices:[],selectedModbusNetworks:[],addNewNetworkToggle:!1,addNewDeviceToggle:!1,isMapMultipleModbusPoints:!1,isMapExistingBacnetPoint:!0,isCreatingMapping:!1,selectedModbusPoint:null,selectedModbusPoints:[],selectedChild1Point:null,selectedChild2Point:null,selectedGenericNetwork:null,selectedGenericDevice:null,genericPointValidation:[l.a.required],genericChildValidation:[l.a.required],fieldValidations:[l.a.required],generatedGenericPoints:[],generatedBacnetPoints:[],arrayRequiredValidation:function(e){return!!(Array.isArray(e)&&e.length>0)||"Required"}}},watch:{selectedModbusPoints:function(e,t){this.onGenericDevicesChange(),this.isMultipleModbusPointsSelected&&(this.selectedChild1Point=null,this.isMapMultipleModbusPoints=!1)}}},o()(Me,"watch",{modbusDeviceNames:function(e,t){ue()(e,t)||(this.modbusDeviceSelectionStates=this.modbusDeviceNames.reduce((function(e,t){return e[t]={name:t,selected:!1},e}),{}))},modbusNetworkNames:function(e,t){ue()(e,t)||(this.modbusNetworkSelectionStates=this.modbusNetworkNames.reduce((function(e,t){return e[t]={name:t,selected:!1},e}),{}))}}),o()(Me,"mounted",(function(){this.isEditForm&&this.serviceMapping&&(this.uuid=this.serviceMapping.uuid,this.isMapMultipleModbusPoints=!0,this.selectedModbusPoint=this.serviceMapping[this.parentMappingKey],this.serviceMapping.hasOwnProperty(this.child1MappingKey)&&(this.selectedChild1Point=this.serviceMapping[this.child1MappingKey]),this.serviceMapping.hasOwnProperty(this.child2MappingKey)&&(this.selectedChild2Point=this.serviceMapping[this.child2MappingKey]),this.genericChildValidation=[])})),o()(Me,"computed",{mappings:function(){return this.serviceMappings},selectedParentMappings:function(){var e=this;return this.serviceMappings.map((function(t){return t[e.parentMappingKey]}))},selectedChild2Mappings:function(){var e=this;return this.serviceMappings.map((function(t){return t[e.child2MappingKey]}))},selectedChild1Mappings:function(){var e=this;return this.serviceMappings.map((function(t){return t[e.child1MappingKey]}))},updatedParentPointsList:function(){return this.selectedModbusDevices,this.selectedModbusNetworks,this.updateParentListItemProperty(this.parentPoints,this.selectedParentMappings)},updatedChild2PointsList:function(){return this.updateLisItemProperty(this.child2Points,this.selectedChild2Mappings)},updatedChild1PointsList:function(){return this.updateLisItemProperty(this.child1Points,this.selectedChild1Mappings)},isAllModbusPointsSelected:function(){return this.selectedModbusPoints.length===this.updatedParentPointsList.length},isMultipleModbusPointsSelected:function(){return this.selectedModbusPoints&&this.selectedModbusPoints.length>1},genericDevices:function(){return this.selectedGenericNetwork&&this.selectedGenericNetwork.devices||[]},modbusSelectionLabel:function(){return this.selectedModbusPoints.length>0?this.parentFieldTitle+" | "+this.selectedModbusPoints.length+" Modbus points selected":this.parentFieldTitle}}),o()(Me,"methods",{getServiceMappings:function(){return this.autoCreateBacnetPoints?this.generatedBacnetPoints.map((function(e){return{bacnet_point:e.bacnetPoint,modbus_point:e.modbusPoint}})):this.autoCreateDevicesAndPoints?this.generatedGenericPoints.map((function(e){return{generic_point:{network:e.network,device:e.device,point:e.point},modbus_point:e.modbusPoint}})):void 0},addMapping:function(){var e,t=this;if(this.$refs.mappingForm.validate()){if(this.mappingErrors=[],!this.isEditForm&&!this.isMapMultipleModbusPoints&&(this.autoCreateDevicesAndPoints||this.autoCreateBacnetPoints)){this.isCreatingMapping=!0;var i=this.getServiceMappings();return this.createModbusBacnetGenericPointMapping(i,this.autoCreateDevicesAndPoints,this.autoCreateBacnetPoints).then((function(e){e.every((function(e){return!e.success}))?t.extractDisplayError(e):(t.selectedModbusPoints=null,t.selectedModbusPoint=null,t.selectedChild2Point=null,t.selectedChild1Point=null,t.autoCreateDevicesAndPoints=!1,t.autoCreateBacnetPoints=!1,t.selectedModbusDevices=[],t.selectedModbusNetworks=[],t.$refs.mappingForm.reset())})).catch((function(e){})).finally((function(){t.isCreatingMapping=!1}))}this.isEditForm||1!=this.selectedModbusPoints.length||(this.selectedModbusPoint=this.selectedModbusPoints[0].item),this.isCreatingMapping=!0,this.createServiceMapping((e={},o()(e,this.parentMappingKey,this.selectedModbusPoint),o()(e,this.child1MappingKey,this.selectedChild1Point),o()(e,this.child2MappingKey,this.selectedChild2Point),e),this.uuid).then((function(){if(t.isEditForm)return t.onCancel();t.selectedModbusPoints=null,t.selectedModbusPoint=null,t.selectedChild2Point=null,t.selectedChild1Point=null,t.$refs.mappingForm.reset()})).finally((function(){t.isCreatingMapping=!1}))}},extractDisplayError:function(e){var t=e.filter((function(e){return!e.success})).map((function(e){return{modbus_point_name:e.data&&e.data.modbus_point_name,child_point_name:e.data&&(e.data.generic_point_name||e.data.bacnet_point_name),message:e.message,index:e.rowIndex}}));this.mappingErrors=t},updateParentListItemProperty:function(e,t){if(!t)return e;var i=t.filter((function(e){return e})).map((function(e){return e.id})),n=[],a=[],s=e.reduce((function(e,t){return i.includes(t.id)?t.disabled=!0:t.disabled=!1,t.networkGroup=t.network.name,t.deviceGroup=t.device.name,e.push(t),e}),[]),r=le()(s,(function(e){return e.networkGroup})),o=oe()(r).reduce((function(e,t){return e[t]=le()(r[t],(function(e){return e.deviceGroup})),e}),{}),c=oe()(o).reduce((function(e,t){var i={text:t,name:t,itemName:""+t,type:"network",isNetwork:!0,isHeader:!0,isNonItem:!0,selected:!1};e.push(i);var s=oe()(o[t]).reduce((function(e,i){var a={text:i,type:"device",isDevice:!0,networkName:t,name:i,itemName:t+":::"+i,isHeader:!0,isNonItem:!0,selected:!1};return e.push(a),e.push.apply(e,se()(o[t][i])),n.push(t+":::"+i),e.push({divider:!0,isNonItem:!0}),e}),[]);return e.push.apply(e,se()(s)),a.push(""+t),e.push({divider:!0,isNonItem:!0}),e}),[]);return this.modbusDeviceNames=[].concat(n),this.modbusNetworkNames=[].concat(a),c},updateLisItemProperty:function(e,t){if(!t)return e;var i=t.filter((function(e){return e})).map((function(e){return e.id}));return e.reduce((function(e,t){return i.includes(t.id)?t.disabled=!0:t.disabled=!1,e.push(t),e}),[])},checkValidation:function(){(this.selectedChild1Point||this.selectedChild2Point||this.selectedGenericDevice||this.autoCreateDevicesAndPoints||this.autoCreateBacnetPoints)&&this.genericChildValidation.pop(),this.selectedChild1Point||this.selectedChild2Point||this.selectedGenericDevice||this.autoCreateDevicesAndPoints||this.autoCreateBacnetPoints||!(this.genericChildValidation.length<1)||this.genericChildValidation.push(l.a.required),this.$refs.mappingForm.resetValidation()},onModbusPointsSelectToggle:function(){var e=this;this.$nextTick((function(){e.isMultipleModbusPointsSelected?e.selectedModbusPoints=[]:e.selectedModbusPoints=e.updatedParentPointsList.slice().filter((function(e){return!e.disabled&&!e.isHeader&&!e.isNonItem}))}))},onGenericDevicesChange:function(){var e=this;Array.isArray(this.selectedModbusPoints)&&this.selectedModbusPoints.length>0&&this.selectedGenericDevice?this.generatedGenericPoints=this.selectedModbusPoints.reduce((function(t,i){var n={};return n.network=e.selectedGenericNetwork,n.device=e.selectedGenericDevice,n.point=i.item,n.name=n.network.name+":"+n.device.name+":"+n.point.name,n.modbusPoint=i,t.push(n),t}),[]):this.generatedGenericPoints=[],this.checkValidation()},onMapExistingChange:function(){this.selectedChild2Point=null,this.genericChildValidation.length<1&&this.genericChildValidation.push(l.a.required),this.generatedGenericPoints=[]},onDeviceSelectAllClick:function(e){var t=this;this.$nextTick((function(){var i=e.itemName;switch(e.type){case"network":t.onSeletAllModbusNetwork(i);break;case"device":t.onSelectedAllModbusDevices(i)}}))},onSeletAllModbusNetwork:function(e){this.modbusNetworkSelectionStates[e].selected=!this.modbusNetworkSelectionStates[e].selected,this.modbusNetworkSelectionStates[e].selected?this.selectedModbusNetworks.push(e):this.selectedModbusNetworks=this.selectedModbusNetworks.filter((function(t){return t!==e}));var t=this.modbusDeviceNames.reduce((function(t,i){return i.split(":::")[0]===e?(t.push(i),t):t}),[]),i=!0,n=!1,a=void 0;try{for(var s,r=j()(t);!(i=(s=r.next()).done);i=!0){var o=s.value;this.onSelectedAllModbusDevices(o)}}catch(e){n=!0,a=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw a}}},onSelectedAllModbusDevices:function(e){var t=this;this.modbusDeviceSelectionStates[e].selected=!this.modbusDeviceSelectionStates[e].selected,this.modbusDeviceSelectionStates[e].selected?this.selectedModbusDevices.push(e):this.selectedModbusDevices=this.selectedModbusDevices.filter((function(t){return t!==e})),this.selectedModbusPoints=this.updatedParentPointsList.filter((function(e){return!e.isNonItem})).reduce((function(e,i){return!i.isHeader&&!i.disabled&&t.selectedModbusDevices.length>0&&t.selectedModbusDevices.findIndex((function(e){return e.split(":::")[0]===i.network.name&&e.split(":::")[1]===i.device.name}))>-1&&e.push(i),e}),[])},getGenericDevice:function(e,t){return{driver:"GENERIC",enable:!1,fault:null,history_enable:!1,name:t,network_uuid:e}},getBacnetPoint:function(e,t,i){return{object_type:"analogOutput",object_name:"bacnet_"+e+"-"+t+"-"+i,address:null,relinquish_default:1,priority_array_write:{_1:null,_2:null,_3:null,_4:null,_5:null,_6:null,_7:null,_8:null,_9:null,_10:null,_11:null,_12:null,_13:null,_14:null,_15:null,_16:null},event_state:"lowLimit",units:"volts",description:"description",enable:!0,use_next_available_address:!0}},onAutoCreateToggle:function(){var e=this;this.autoCreateDevicesAndPoints&&(this.autoCreateBacnetPoints=!1,this.generatedBacnetPoints=[]),this.autoCreateDevicesAndPoints&&this.selectedGenericNetwork?(this.selectedGenericDevice=null,this.generatedGenericPoints=this.selectedModbusPoints.reduce((function(t,i){var n={};return n.network=e.selectedGenericNetwork,n.device=e.getGenericDevice(n.network.uuid,i.device.name),n.point=i.point,n.name=n.network.name+":"+n.device.name+":"+n.point.name,n.modbusPoint=i,t.push(n),t}),[])):this.generatedGenericPoints=[],this.checkValidation()},onAutoBacnetCreateToggle:function(){var e=this;this.autoCreateBacnetPoints&&(this.autoCreateDevicesAndPoints=!1,this.generatedGenericPoints=[]),this.autoCreateBacnetPoints?(this.selectedChild1Point=null,this.generatedBacnetPoints=this.selectedModbusPoints.reduce((function(t,i){var n={};return n.modbusPoint=i,n.bacnetPoint=e.getBacnetPoint(i.network.name,i.device.name,i.point.name),n.name=n.bacnetPoint.object_name,t.push(n),t}),[])):this.generatedBacnetPoints=[],this.checkValidation()},onModbusPointsSelectionClear:function(){this.selectedModbusDevices=[],this.selectedModbusNetworks=[]}}),Me),De=Object(u.a)(Ce,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-form",{ref:"mappingForm",class:e.isEditForm?"":"mb-4",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[i("v-row",{attrs:{dense:""}},[i("v-col",{attrs:{cols:12}},[e.isEditForm?i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"id","item-text":"name","auto-select-first":"",rules:e.fieldValidations,label:e.parentFieldTitle,items:e.updatedParentPointsList},model:{value:e.selectedModbusPoint,callback:function(t){e.selectedModbusPoint=t},expression:"selectedModbusPoint"}}):e._e(),e._v(" "),e.isEditForm?e._e():i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"id","item-text":"name","auto-select-first":"",rules:[e.arrayRequiredValidation],label:e.modbusSelectionLabel,items:e.updatedParentPointsList,multiple:""},on:{"click:clear":e.onModbusPointsSelectionClear},scopedSlots:e._u([{key:"item",fn:function(t){var n=t.item,a=t.attrs;return[n.isHeader?[i("v-list-item",{class:n.isDevice?"pl-8":"",attrs:{ripple:""},on:{click:function(t){return e.onDeviceSelectAllClick(n)}}},[n.isDevice?i("v-icon",{staticClass:"mr-2"},[e._v("\n                "+e._s(e.selectedModbusDevices.indexOf(n.networkName+":::"+n.name)>-1?"mdi-close-box":"mdi-checkbox-blank-outline")+"\n              ")]):e._e(),e._v(" "),n.isNetwork?i("v-icon",{staticClass:"mr-2"},[e._v("\n                "+e._s(e.selectedModbusNetworks.indexOf(""+n.name)>-1?"mdi-close-box":"mdi-checkbox-blank-outline")+"\n              ")]):e._e(),e._v(" "),i("v-list-item-title",[n.isDevice?i("span",{staticClass:"caption"},[e._v("Select all modbus points of")]):e._e(),e._v(" "),n.isNetwork?i("span",{staticClass:"caption"},[e._v("Select all modbus devices of")]):e._e(),e._v(" "),i("strong",[e._v(e._s(n.name+" "))])])],1)]:[i("v-list-item-content",{staticClass:"ml-12"},[i("v-list-item-title",[n.disabled?e._e():i("v-icon",{staticClass:"mr-2"},[e._v("\n                  "+e._s("true"==a["aria-selected"]?"mdi-checkbox-marked":"mdi-checkbox-blank-outline")+"\n                ")]),e._v(" "),i("span",{staticClass:"caption"},[e._v(e._s(n.network.name))]),e._v(" "),i("span",{staticClass:"caption"},[e._v(e._s(n.device.name))]),e._v(" "),i("strong",[e._v(e._s(n.point.name))]),e._v(" "),n.disabled?i("span",{staticClass:"already-mapped-label"},[e._v(" Already Mapped ")]):e._e()],1)],1)]]}},{key:"prepend-item",fn:function(){return[i("v-list-item",{attrs:{ripple:""},on:{click:e.onModbusPointsSelectToggle}},[i("v-icon",{staticClass:"mr-2"},[e._v("\n              "+e._s(e.isMultipleModbusPointsSelected?"mdi-close-box":"mdi-checkbox-blank-outline")+"\n            ")]),e._v(" "),i("v-list-item-content",[i("v-list-item-title",[e._v(" Select all ")])],1)],1),e._v(" "),i("v-divider",{staticClass:"mt-2"})]},proxy:!0}],null,!1,1693373720),model:{value:e.selectedModbusPoints,callback:function(t){e.selectedModbusPoints=t},expression:"selectedModbusPoints"}})],1),e._v(" "),i("v-col",{attrs:{cols:"12"}},[i("v-row",{attrs:{dense:""}},[i("v-col",{attrs:{cols:"6"}},[i("v-switch",{staticClass:"pr-4",attrs:{inset:"",label:"Auto create new bacnet point(s) and mapping(s)",color:"primary"},on:{change:e.onAutoBacnetCreateToggle},model:{value:e.autoCreateBacnetPoints,callback:function(t){e.autoCreateBacnetPoints=t},expression:"autoCreateBacnetPoints"}})],1),e._v(" "),i("v-col",{attrs:{cols:"6"}},[i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"id","item-text":"name","auto-select-first":"",label:e.child1FieldTitle,rules:e.genericChildValidation,items:e.updatedChild1PointsList,disabled:!!e.selectedChild2Point||e.isMultipleModbusPointsSelected},on:{change:e.checkValidation},model:{value:e.selectedChild1Point,callback:function(t){e.selectedChild1Point=t},expression:"selectedChild1Point"}})],1)],1)],1),e._v(" "),!e.isMapMultipleModbusPoints&&e.generatedBacnetPoints.length>0?i("v-col",{attrs:{cols:"12"}},[i("v-item-group",{staticClass:"text-left",attrs:{multiple:""}},[i("v-subheader",[e._v("Generated Bacnet Points")]),e._v(" "),e._l(e.generatedBacnetPoints,(function(t){return i("v-item",{key:t.name,staticClass:"ml-2 mb-2"},[i("v-chip",{attrs:{"active-class":"green--text",value:t}},[e._v("\n            "+e._s(t.name)+"\n          ")])],1)}))],2)],1):e._e(),e._v(" "),i("v-col",{attrs:{cols:"12"}},[i("v-row",{attrs:{dense:""}},[e.isMapMultipleModbusPoints?e._e():i("div",{staticClass:"existing-generic-mapping-wrapper"},[i("v-row",{attrs:{dense:""}},[i("v-col",{attrs:{cols:"12"}},[i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"uuid",disabled:!(e.selectedModbusPoints&&e.selectedModbusPoints.length>0),"item-text":"name","auto-select-first":"",rules:e.genericChildValidation,label:"Select Existing Generic Network",items:e.genericNetworks},on:{change:e.onAutoCreateToggle},model:{value:e.selectedGenericNetwork,callback:function(t){e.selectedGenericNetwork=t},expression:"selectedGenericNetwork"}})],1)],1),e._v(" "),i("v-row",{attrs:{dense:""}},[i("v-col",{attrs:{cols:"6"}},[i("v-switch",{staticClass:"pr-4",attrs:{inset:"",label:"Auto create new device(s), point(s) and mapping(s)",color:"primary"},on:{change:e.onAutoCreateToggle},model:{value:e.autoCreateDevicesAndPoints,callback:function(t){e.autoCreateDevicesAndPoints=t},expression:"autoCreateDevicesAndPoints"}})],1),e._v(" "),i("v-col",{attrs:{cols:"6"}},[e.autoCreateDevicesAndPoints?e._e():i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"uuid",disabled:!(e.selectedModbusPoints&&e.selectedModbusPoints.length>0),"item-text":"name","auto-select-first":"",rules:e.genericChildValidation,label:"Select Existing Generic Device",items:e.genericDevices},on:{change:e.onGenericDevicesChange},model:{value:e.selectedGenericDevice,callback:function(t){e.selectedGenericDevice=t},expression:"selectedGenericDevice"}})],1)],1)],1),e._v(" "),e.isMapMultipleModbusPoints?i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"id","item-text":"name","auto-select-first":"",label:e.child2FieldTitle,rules:e.genericChildValidation,disabled:!!e.selectedChild1Point,items:e.updatedChild2PointsList},on:{change:e.checkValidation},model:{value:e.selectedChild2Point,callback:function(t){e.selectedChild2Point=t},expression:"selectedChild2Point"}}):e._e()],1)],1),e._v(" "),!e.isMapMultipleModbusPoints&&e.generatedGenericPoints.length>0?i("v-col",{attrs:{cols:"12"}},[i("v-item-group",{staticClass:"text-left",attrs:{multiple:""}},[i("v-subheader",[e._v("Generated Generic Points")]),e._v(" "),e._l(e.generatedGenericPoints,(function(t){return i("v-item",{key:t.name,staticClass:"ml-2 mb-2"},[i("v-chip",{attrs:{"active-class":"green--text",value:t}},[e._v("\n            "+e._s(t.name)+"\n          ")])],1)}))],2)],1):e._e(),e._v(" "),i("v-col",{attrs:{cols:"12"}},e._l(e.mappingErrors,(function(t){return i("v-alert",{key:t.index,attrs:{dense:"",outlined:"",type:"warning"}},[e._v("\n        Mapping Error: "),i("strong",{staticClass:"white--text"},[e._v(e._s(t.modbus_point_name))]),e._v(" --\n        "),i("strong",{staticClass:"white--text"},[e._v(e._s(t.child_point_name))]),e._v(" |\n        "),i("span",[e._v(e._s(t.message))])])})),1),e._v(" "),e.isEditForm?e._e():i("v-col",{staticClass:"flex justify-center align-center",attrs:{cols:"2"}},[i("rbx-button",{attrs:{loading:e.isCreatingMapping,block:!0,color:"pink",click:e.addMapping,title:"Add"}})],1)],1),e._v(" "),e.isEditForm?i("v-card-actions",[i("v-spacer"),e._v(" "),i("v-btn",{attrs:{color:"darken-1",text:""},on:{click:e.onCancel}},[e._v(" Cancel ")]),e._v(" "),i("v-btn",{attrs:{color:"blue darken-1",loading:e.isCreatingMapping,text:""},on:{click:e.addMapping}},[e._v(" Save ")])],1):e._e()],1)}),[],!1,null,"57090653",null).exports,we=i("PWxN"),Se=i.n(we),Ie="/service-mapping/modbus-generic-bacnet-mapping";function Ne(e){return e.map((function(e){var t={};return e.generic_point_uuid&&(t={genericPoint:{id:e.generic_point_uuid,name:e.generic_point_name}}),e.bacnet_point_uuid&&(t=a()({},t,{bacnetPoint:{id:e.bacnet_point_uuid,name:e.bacnet_point_name}})),a()({},t,{uuid:e.uuid,modbusPoint:{id:e.modbus_point_uuid,name:e.modbus_point_name}})}))}function Le(e){var t={};return e.bacnetPoint&&e.bacnetPoint.id&&(t={bacnet_point_uuid:e.bacnetPoint.id,bacnet_point_name:e.bacnetPoint.name}),e.genericPoint&&e.genericPoint.id&&(t=a()({},t,{generic_point_uuid:e.genericPoint.id,generic_point_name:e.genericPoint.name})),e.uuid&&(t=a()({},t,{uuid:e.uuid})),a()({},t,{modbus_point_uuid:e.modbusPoint.id,modbus_point_name:e.modbusPoint.name})}function Ge(e,t,i,n){var s={};return s.modbus_point=a()({},t[e.modbus_point_uuid]),e.bacnet_point_uuid&&(s.bacnet_point=a()({},i[e.bacnet_point_uuid])),e.generic_point_uuid&&(s.generic_point=a()({},n[e.generic_point_uuid])),(s=z()(s)).modbus_point&&(delete s.modbus_point.id,delete s.modbus_point.uuid,delete s.modbus_point.device.uuid,delete s.modbus_point.network.uuid,delete s.modbus_point.point.uuid),s.generic_point&&(delete s.generic_point.id,delete s.generic_point.uuid,delete s.generic_point.device.uuid,delete s.generic_point.network.uuid,delete s.generic_point.point.uuid),s.bacnet_point&&(delete s.bacnet_point.id,delete s.bacnet_point.uuid),s}function Re(e){return e.map((function(e){return L.a.unflatten(e,{transformKey:function(e){return e.trim()}})}))}var Te=function(e){return I.a.delete(Ie+"/"+e.uuid)},Fe=function(e){return I.a.post(Ie+"/file-upload",function(e){return e.map((function(e){var t=a()({},e);return D()(e,"generic_point.point.name")&&D()(e,"generic_point.point.name")&&D()(e,"generic_point.point.name")||(t=Se()(t,["generic_point"])),D()(e,"bacnet_point.name")||(t=Se()(t,["bacnet_point"])),t}))}(e))},Ee=i("A5Vd"),Be={name:"modus-generic-bacnet-point-mapping-import-dialog",props:["dataRows","isOpen","close","bacnetPoints","genericPoints","modusPoints","syncData"],data:function(){return{valid:!1,isRequestOnce:!1,isCreatingMapping:!1,errors:[],rules:{required:function(e){return!!e||"Required"}},errorTableHeaders:[{text:"Row",value:"rowIndex",sortable:!1},{text:"Error Message",value:"message",sortable:!1}],modbusRtuPorts:[].concat(se()(Ee.e)),headers:[{text:"Actions",value:"actions",sortable:!1},{text:"Row",value:"rowNumber",sortable:!1},{text:"Modbus Network Name",value:"modbusNetworkName",sortable:!1},{text:"Modbus Network RTU Port",value:"modbusNetworkRTUPort",sortable:!1},{text:"Modbus Device Name",value:"modbusDeviceName",sortable:!1},{text:"Modbus Device Address",value:"modbusDeviceAddress",sortable:!1},{text:"Modbus Point Name",value:"modbusPointName",sortable:!1},{text:"Modbus Point Regiter",value:"modbusPointRegister",sortable:!1},{text:"Generic Network Name",value:"genericNetworkName",sortable:!1},{text:"Generic Device Name",value:"genericDeviceName",sortable:!1},{text:"Generic Point Name",value:"genericPointName",sortable:!1},{text:"Bacnet Point Name",value:"bacnetPointName",sortable:!1},{text:"Bacnet Point Address",value:"bacnetPointAddress",sortable:!1}]}},computed:{dataItems:function(){return(this.dataRows||[]).map((function(e){return a()({},e,{generic_point:e.generic_point||{point:{name:""},device:{name:""},network:{name:""}},bacnet_point:e.bacnet_point||{address:null,name:""},isGenericPointDisabled:!e.generic_point,isBacnetPointDisabled:!e.bacnet_point})}))}},methods:{clickDeleteImport:function(e){this.dataRows=this.dataRows.filter((function(t,i){return i!==e})),this.errors=this.errors.filter((function(e,t){return itemIndex!==t}))},getErrorFromResult:function(e){return{rowIndex:e.rowIndex+1,message:e.message}},createMapping:function(){var e=this;this.$refs.form.validate()&&(this.isCreatingMapping=!0,this.isRequestOnce=!0,Fe(this.dataItems).then((function(t){e.errors=t.reduce((function(t,i){return i.success||t.push(e.getErrorFromResult(i)),t}),[]),t.map((function(e){return e.success})).every((function(e){return e}))&&(e.syncData(),e.closeDialog())})).catch((function(e){})).finally((function(){e.isCreatingMapping=!1})))},closeDialog:function(){this.isRequestOnce&&this.syncData(),this.close()}}},Ke=Object(u.a)(Be,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-dialog",{attrs:{persistent:""},model:{value:e.isOpen,callback:function(t){e.isOpen=t},expression:"isOpen"}},[i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[e._v("Import Mappings")])]),e._v(" "),i("v-card-text",[i("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[i("v-data-table",{staticClass:"elevation-1 mb-4",attrs:{headers:e.headers,items:e.dataItems,"footer-props":{showFirstLastPage:!0,firstIcon:"mdi-chevron-double-left",lastIcon:"mdi-chevron-double-right",prevIcon:"mdi-chevron-left",nextIcon:"mdi-chevron-right"}},scopedSlots:e._u([{key:"item.actions",fn:function(t){var n=t.item;return[i("v-icon",{attrs:{small:"",color:"error"},on:{click:function(t){return e.clickDeleteImport(n.index)}}},[e._v(" mdi-delete ")])]}},{key:"item.rowNumber",fn:function(t){t.item;var n=t.index;return[i("span",[e._v(e._s(+n+1))])]}},{key:"item.modbusNetworkRTUPort",fn:function(t){var n=t.item;return[i("v-combobox",{attrs:{items:e.modbusRtuPorts,label:"rtu port"},model:{value:n.modbus_point.network.rtu_port,callback:function(t){e.$set(n.modbus_point.network,"rtu_port",t)},expression:"item.modbus_point.network.rtu_port"}})]}},{key:"item.modbusNetworkName",fn:function(t){var n=t.item;return[i("v-text-field",{staticStyle:{width:"100px"},attrs:{"single-line":"",required:""},model:{value:n.modbus_point.network.name,callback:function(t){e.$set(n.modbus_point.network,"name",t)},expression:"item.modbus_point.network.name"}})]}},{key:"item.modbusDeviceName",fn:function(t){var n=t.item;return[i("v-text-field",{staticStyle:{width:"100px"},attrs:{"single-line":"",required:""},model:{value:n.modbus_point.device.name,callback:function(t){e.$set(n.modbus_point.device,"name",t)},expression:"item.modbus_point.device.name"}})]}},{key:"item.modbusDeviceAddress",fn:function(t){var n=t.item;return[i("v-text-field",{attrs:{"single-line":"",type:"number",min:"0"},model:{value:n.modbus_point.device.address,callback:function(t){e.$set(n.modbus_point.device,"address",t)},expression:"item.modbus_point.device.address"}})]}},{key:"item.modbusPointName",fn:function(t){var n=t.item;return[i("v-text-field",{staticStyle:{width:"100px"},attrs:{"single-line":"",rules:[e.rules.required],required:""},model:{value:n.modbus_point.point.name,callback:function(t){e.$set(n.modbus_point.point,"name",t)},expression:"item.modbus_point.point.name"}})]}},{key:"item.modbusPointRegister",fn:function(t){var n=t.item;return[i("v-text-field",{attrs:{"single-line":"",type:"number",min:"0"},model:{value:n.modbus_point.point.register,callback:function(t){e.$set(n.modbus_point.point,"register",t)},expression:"item.modbus_point.point.register"}})]}},{key:"item.genericNetworkName",fn:function(t){var n=t.item;return[i("v-text-field",{staticStyle:{width:"100px"},attrs:{disabled:n.isGenericPointDisabled,"single-line":""},model:{value:n.generic_point.network.name,callback:function(t){e.$set(n.generic_point.network,"name",t)},expression:"item.generic_point.network.name"}})]}},{key:"item.genericDeviceName",fn:function(t){var n=t.item;return[i("v-text-field",{staticStyle:{width:"100px"},attrs:{disabled:n.isGenericPointDisabled,"single-line":""},model:{value:n.generic_point.device.name,callback:function(t){e.$set(n.generic_point.device,"name",t)},expression:"item.generic_point.device.name"}})]}},{key:"item.genericPointName",fn:function(t){var n=t.item;return[i("v-text-field",{staticStyle:{width:"100px"},attrs:{disabled:n.isGenericPointDisabled,"single-line":""},model:{value:n.generic_point.point.name,callback:function(t){e.$set(n.generic_point.point,"name",t)},expression:"item.generic_point.point.name"}})]}},{key:"item.bacnetPointName",fn:function(t){var n=t.item;return[i("v-text-field",{staticStyle:{width:"100px"},attrs:{disabled:n.isBacnetPointDisabled,"single-line":""},model:{value:n.bacnet_point.name,callback:function(t){e.$set(n.bacnet_point,"name",t)},expression:"item.bacnet_point.name"}})]}},{key:"item.bacnetPointAddress",fn:function(t){var n=t.item;return[i("v-text-field",{staticStyle:{width:"100px"},attrs:{disabled:n.isBacnetPointDisabled,"single-line":""},model:{value:n.bacnet_point.address,callback:function(t){e.$set(n.bacnet_point,"address",t)},expression:"item.bacnet_point.address"}})]}}])})],1)],1),e._v(" "),e.errors.length>=1?i("v-card",{staticClass:"px-8 mt-n15"},[i("v-card-title",{attrs:{color:"red darken-1"}},[e._v("Errors")]),e._v(" "),i("v-card-text",[i("v-data-table",{staticClass:"elevation-1 mb-1",attrs:{"hide-default-footer":"",headers:e.errorTableHeaders,items:e.errors}})],1)],1):e._e(),e._v(" "),i("v-card-actions",[i("v-spacer"),e._v(" "),i("v-btn",{attrs:{color:"darken-1",text:""},on:{click:e.closeDialog}},[e._v(" Cancel ")]),e._v(" "),i("v-btn",{attrs:{color:"blue darken-1",loading:e.isCreatingMapping,text:""},on:{click:e.createMapping}},[e._v(" Save ")])],1)],1)],1)}),[],!1,null,null,null).exports,Ae={components:{RbxButton:c.a},props:["serviceMappings","isEditForm","parentPoints","child1Points","child2Points","serviceMapping","parentMappingKey","child1MappingKey","child2MappingKey","createServiceMapping","parentFieldTitle","child1FieldTitle","child2FieldTitle","onCancel"],data:function(){return{uuid:null,valid:!1,isCreatingMapping:!1,selectedParentPoint:null,selectedChild1Point:null,selectedChild2Point:null,genericChildValidation:[l.a.required],fieldValidations:[l.a.required]}},mounted:function(){this.isEditForm&&this.serviceMapping&&(this.uuid=this.serviceMapping.uuid,this.selectedParentPoint=this.serviceMapping[this.parentMappingKey],this.serviceMapping.hasOwnProperty(this.child1MappingKey)&&(this.selectedChild1Point=this.serviceMapping[this.child1MappingKey]),this.serviceMapping.hasOwnProperty(this.child2MappingKey)&&(this.selectedChild2Point=this.serviceMapping[this.child2MappingKey]),this.genericChildValidation=[])},computed:{mappings:function(){return this.serviceMappings},selectedParentMappings:function(){var e=this;return this.serviceMappings.map((function(t){return t[e.parentMappingKey]}))},selectedChild2Mappings:function(){var e=this;return this.serviceMappings.map((function(t){return t[e.child2MappingKey]}))},selectedChild1Mappings:function(){var e=this;return this.serviceMappings.map((function(t){return t[e.child1MappingKey]}))},updatedParentPointsList:function(){return this.updateLisItemProperty(this.parentPoints,this.selectedParentMappings)},updatedChild2PointsList:function(){return this.updateLisItemProperty(this.child2Points,this.selectedChild2Mappings)},updatedChild1PointsList:function(){return this.updateLisItemProperty(this.child1Points,this.selectedChild1Mappings)}},methods:{addMapping:function(){var e,t=this;this.$refs.mappingForm.validate()&&(this.selectedParentMappings.push(this.selectedParentPoint),this.selectedChild1Mappings.push(this.selectedChild1Point),this.selectedChild2Mappings.push(this.selectedChild2Point),this.isCreatingMapping=!0,this.createServiceMapping((e={},o()(e,this.parentMappingKey,this.selectedParentPoint),o()(e,this.child1MappingKey,this.selectedChild1Point),o()(e,this.child2MappingKey,this.selectedChild2Point),e),this.uuid).then((function(){if(t.isEditForm)return t.onCancel();t.selectedParentPoint=null,t.selectedChild2Point=null,t.selectedChild1Point=null,t.$refs.mappingForm.reset()})).finally((function(){t.isCreatingMapping=!1})))},updateLisItemProperty:function(e,t){if(!t)return e;var i=t.filter((function(e){return e})).map((function(e){return e.id}));return e.reduce((function(e,t){return i.includes(t.id)?t.disabled=!0:t.disabled=!1,e.push(t),e}),[])},checkValidation:function(){(this.selectedChild1Point||this.selectedChild2Point)&&this.genericChildValidation.pop(),!this.selectedChild1Point&&!this.selectedChild2Point&&this.genericChildValidation.length<1&&this.genericChildValidation.push(l.a.required),this.$refs.mappingForm.resetValidation()}}},$e=Object(u.a)(Ae,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-form",{ref:"mappingForm",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[i("v-row",[i("v-col",{attrs:{cols:e.isEditForm?12:4}},[i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"id","item-text":"name","auto-select-first":"",rules:e.fieldValidations,label:e.parentFieldTitle,items:e.updatedParentPointsList},model:{value:e.selectedParentPoint,callback:function(t){e.selectedParentPoint=t},expression:"selectedParentPoint"}})],1),e._v(" "),i("v-col",{attrs:{cols:e.isEditForm?12:3}},[i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"id","item-text":"name","auto-select-first":"",label:e.child1FieldTitle,rules:e.genericChildValidation,items:e.updatedChild1PointsList,disabled:!!e.selectedChild2Point},on:{change:e.checkValidation},model:{value:e.selectedChild1Point,callback:function(t){e.selectedChild1Point=t},expression:"selectedChild1Point"}})],1),e._v(" "),i("v-col",{attrs:{cols:e.isEditForm?12:3}},[i("v-autocomplete",{attrs:{clearable:"","return-object":"","item-value":"id","item-text":"name","auto-select-first":"",label:e.child2FieldTitle,rules:e.genericChildValidation,disabled:!!e.selectedChild1Point,items:e.updatedChild2PointsList},on:{change:e.checkValidation},model:{value:e.selectedChild2Point,callback:function(t){e.selectedChild2Point=t},expression:"selectedChild2Point"}})],1),e._v(" "),e.isEditForm?e._e():i("v-col",{staticClass:"flex justify-center align-center",attrs:{cols:"2"}},[i("rbx-button",{attrs:{block:!0,color:"pink",click:e.addMapping,title:"Add"}})],1)],1),e._v(" "),e.isEditForm?i("v-card-actions",[i("v-spacer"),e._v(" "),i("v-btn",{attrs:{color:"darken-1",text:""},on:{click:e.onCancel}},[e._v(" Cancel ")]),e._v(" "),i("v-btn",{attrs:{color:"blue darken-1",loading:e.isCreatingMapping,text:""},on:{click:e.addMapping}},[e._v(" Save ")])],1):e._e()],1)}),[],!1,null,"1f6e1c78",null).exports,Oe={name:"service-mapping-grid",components:{ConfirmDialog:h.a,ParentChildMappingForm:$e,GridToolbar:y},props:["loading","parentMappingKey","child1MappingKey","child2MappingKey","serviceMappings","parentPoints","child1Points","child2Points","updateServiceMapping","deleteItem","deleteItems","parentHeaderTitle","child1HeaderTitle","child2HeaderTitle","fileName","receiveDataRows","formatDataService"],data:function(){return{deleteServiceMappingDialog:!1,isDeletingItem:!1,selectedItem:null,selectedItems:[],deletionType:null,editServiceMappingDialog:!1,headers:[{text:this.parentHeaderTitle,align:"start",value:"parentName"},{text:this.child1HeaderTitle,align:"start",value:"child1Name"},{text:this.child2HeaderTitle,align:"start",value:"child2Name"},{text:"Actions",align:"start",value:"actions",sortable:!1}]}},computed:{items:function(){var e=this;return this.serviceMappings.map((function(t){return a()({},t,{parentName:t[e.parentMappingKey].name,child1Name:t[e.child1MappingKey]&&t[e.child1MappingKey].name||"-",child2Name:t[e.child2MappingKey]&&t[e.child2MappingKey].name||"-"})}))},isDeleteEnabled:function(){return this.selectedItems.length>0}},methods:{toggleDeleteDialog:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.deletionType=t,this.deleteServiceMappingDialog=!this.deleteServiceMappingDialog,e&&this.deleteServiceMappingDialog?this.selectedItem=e:this.selectedItem=null},toggleServiceMappingDialog:function(e){this.editServiceMappingDialog=!this.editServiceMappingDialog,this.editServiceMappingDialog?this.selectedItem=e:this.selectedItem=null},closeDeleteDialog:function(){this.deleteServiceMappingDialog=!1,this.selectedItem=null,this.deletionType=null},handleDeleteItem:function(){switch(this.deletionType){case"single":this.onDeleteRow();break;case"multiple":this.onDeleteRows()}},onDeleteRows:function(){var e=this;this.selectedItems.length>0&&(this.isDeletingItem=!0,this.deleteItems(this.selectedItems).then((function(){e.closeDeleteDialog()})).finally((function(){e.isDeletingItem=!1})))},onDeleteRow:function(){var e=this;this.isDeletingItem=!0,this.deleteItem(this.selectedItem).then((function(){e.closeDeleteDialog()})).finally((function(){e.isDeletingItem=!1}))},onCopy:function(e){var t=this.formatDataService(this.selectedItems);e(m()(t))}}},Ve={name:"modbus-generic-bacnet-points-mapping",components:{ParentChildMappingForm:$e,ParentChildMappingGrid:Object(u.a)(Oe,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("grid-toolbar",{attrs:{"on-copy":e.onCopy,items:e.items,toolbarTitle:"Mappings","file-name":e.fileName,"format-data-service":e.formatDataService,"receive-data-rows":e.receiveDataRows,"is-delete-enabled":e.isDeleteEnabled,"on-delete":function(){return e.toggleDeleteDialog(null,"multiple")}}}),e._v(" "),i("v-data-table",{attrs:{"item-key":"uuid","show-select":"",loading:e.loading,headers:e.headers,items:e.items,"footer-props":{showFirstLastPage:!0,firstIcon:"mdi-chevron-double-left",lastIcon:"mdi-chevron-double-right",prevIcon:"mdi-chevron-left",nextIcon:"mdi-chevron-right"}},scopedSlots:e._u([{key:"item.actions",fn:function(t){var n=t.item;return[i("v-btn",{staticClass:"white--text",attrs:{icon:"",small:"",color:"primary"},on:{click:function(){return e.toggleServiceMappingDialog(n)}}},[i("v-icon",{attrs:{small:"",dark:""}},[e._v(" mdi-pencil ")])],1),e._v(" "),i("v-btn",{staticClass:"white--text",attrs:{icon:"",small:"",color:"error"},on:{click:function(){return e.toggleDeleteDialog(n,"single")}}},[i("v-icon",{attrs:{small:"",dark:""}},[e._v(" mdi-delete ")])],1)]}}]),model:{value:e.selectedItems,callback:function(t){e.selectedItems=t},expression:"selectedItems"}}),e._v(" "),i("confirm-dialog",{attrs:{"is-open":e.deleteServiceMappingDialog,loading:e.isDeletingItem,"on-close":function(){return e.closeDeleteDialog()},"on-confirm":function(){return e.handleDeleteItem()},"dialog-text":"Do you want to delete the mapping?"}}),e._v(" "),i("v-dialog",{attrs:{"max-width":"500px"},model:{value:e.editServiceMappingDialog,callback:function(t){e.editServiceMappingDialog=t},expression:"editServiceMappingDialog"}},[i("v-card",[i("v-card-title",[i("span",{staticClass:"headline"},[e._v("Edit Mapping")])]),e._v(" "),i("v-card-text",[i("parent-child-mapping-form",{attrs:{"is-edit-form":!0,"on-cancel":function(){return e.toggleServiceMappingDialog()},"service-mapping":e.selectedItem,parentPoints:e.parentPoints,child1Points:e.child1Points,child2Points:e.child2Points,parentMappingKey:e.parentMappingKey,child1MappingKey:e.child1MappingKey,child2MappingKey:e.child2MappingKey,parentFieldTitle:e.parentHeaderTitle,child1FieldTitle:e.child1HeaderTitle,child2FieldTitle:e.child2HeaderTitle,serviceMappings:e.serviceMappings,createServiceMapping:e.updateServiceMapping}})],1)],1)],1)],1)}),[],!1,null,null,null).exports,ModbusGenericBcnetPointMappingForm:De,ModbusGenericBacnetPointMappingImportDialog:Ke,ModbusGenericBacnetPointMappingForm:De},data:function(){return{dataRows:[],genericNetworks:[],isUpdating:!1,serviceMappings:[],genericPoints:[],genericPointsMap:{},genericNetworkDevices:[],bacnetPoints:[],bacnetPointsMap:{},modbusPoints:[],modbusPointsMap:{},modbusNetworks:[],isFetchingGridData:!1,openImportMappingDialog:!1}},mounted:function(){this.syncData()},methods:{syncData:function(){this.fetchServiceMapping(),this.fetchBacnetPoints(),this.fetchGenericPoints(),this.fetchModbusPoints(),this.fetchGenericDevices()},fetchGenericDevices:function(){var e=this;Z().then((function(t){var i=t.genericNetworks;e.genericNetworks=i})).catch((function(e){}))},fetchServiceMapping:function(){var e=this;return this.isFetchingGridData=!0,I.a.get(""+Ie).then(Ne).then((function(t){e.serviceMappings=t})).finally((function(){e.isFetchingGridData=!1}))},fetchGenericPoints:function(){var e=this;X().then((function(t){e.genericPoints=t,e.genericPointsMap=e.createMap(e.genericPoints)})).catch((function(e){}))},fetchBacnetPoints:function(){var e=this;ee().then((function(t){e.bacnetPoints=t.map((function(e){return a()({},e,{id:e.uuid,name:e.object_name})})),e.bacnetPointsMap=e.createMap(e.bacnetPoints)})).catch((function(e){}))},fetchModbusPoints:function(){var e=this;I.a.get("/point-server/network?with_children=true&points=true").then(Q).then((function(t){var i=t.networkPoints,n=t.networks;e.modbusPoints=i,e.modbusNetworks=n,e.modbusPointsMap=e.createMap(e.modbusPoints)})).catch((function(e){}))},createServiceMapping:function(e){var t=this;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return I.a.post(""+Ie,Le(e))}(e).then((function(){t.fetchServiceMapping(),t.$toasted.show(te.c.success)})).catch((function(e){t.$toasted.show(te.c.error,{type:"error"})})).finally((function(){}))},updateServiceMapping:function(e,t){var i=this;return function(){var e=arguments[1],t=Le(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return I.a.patch(Ie+"/"+e,t)}(e,t).then((function(){i.fetchServiceMapping(),i.$toasted.show(te.g.success)})).catch((function(e){i.$toasted.show(te.g.error,{type:"error"})}))},deleteServiceMapping:function(e){var t=this;return Te(e).then((function(){t.fetchServiceMapping(),t.$toasted.show(te.d.success)})).catch((function(e){t.$toasted.show(te.d.error,{type:"error"}),console.error(e)}))},deleteServiceMappings:function(e){var t=this;return function(e){return S.a.all(e.map((function(e){return Te(e)})))}(e).then((function(){t.fetchServiceMapping(),t.$toasted.show(te.e.success)})).catch((function(e){t.$toasted.show(te.e.error,{type:"error"})}))},formatExportData:function(e,t){var i=this;return"copy"===t?e.map(Le).map((function(e){return Ge(e,i.modbusPointsMap,i.bacnetPointsMap,i.genericPointsMap)})):function(e){return e.map((function(e){return L.a.flatten(e)}))}(e.map(Le).map((function(e){return Ge(e,i.modbusPointsMap,i.bacnetPointsMap,i.genericPointsMap)})))},createMap:function(e){return(e||[]).reduce((function(e,t){return e[t.uuid]=t,e}),{})},receiveDataRows:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.length>=1&&(this.dataRows=Re(e),this.openImportMappingDialog=!0)},closeImportMappingDialog:function(){this.openImportMappingDialog=!1},createModbusBacnetGenericPointMapping:function(e,t,i){var n=this;return function(e,t){return I.a.post(Ie+"/bulk-service-mapping?"+fe.a.stringify(t),e)}(e,{autoCreateGenericDevice:t,autoCreateBacnetDevice:i}).then((function(e){return n.fetchServiceMapping(),e}))}}},je={name:"service-mapping",components:{RubixBacnetPointsMapping:ne,LoraGenericBacnetPointsMapping:xe,ModbusGenericBacnetPointsMapping:Object(u.a)(Ve,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-card-text",[i("modbus-generic-bacnet-point-mapping-form",{attrs:{parentPoints:e.modbusPoints,child1Points:e.bacnetPoints,child2Points:e.genericPoints,parentMappingKey:"modbusPoint",child1MappingKey:"bacnetPoint",child2MappingKey:"genericPoint",parentFieldTitle:"Modbus Points",child1FieldTitle:"BACnet Points",child2FieldTitle:"Rubix Points",createModbusBacnetGenericPointMapping:e.createModbusBacnetGenericPointMapping,"modbus-networks":e.modbusNetworks,serviceMappings:e.serviceMappings,createServiceMapping:e.createServiceMapping,genericNetworks:e.genericNetworks}}),e._v(" "),i("v-divider"),e._v(" "),i("parent-child-mapping-grid",{attrs:{loading:e.isFetchingGridData,fileName:"modus-bacnet-generic-service-mapping","format-data-service":e.formatExportData,parentPoints:e.modbusPoints,child1Points:e.bacnetPoints,child2Points:e.genericPoints,parentMappingKey:"modbusPoint",child1MappingKey:"bacnetPoint",child2MappingKey:"genericPoint",serviceMappings:e.serviceMappings,deleteItem:e.deleteServiceMapping,deleteItems:e.deleteServiceMappings,parentHeaderTitle:"Modbus Points",child1HeaderTitle:"BACnet Points",child2HeaderTitle:"Rubix Points",updateServiceMapping:e.updateServiceMapping,"receive-data-rows":e.receiveDataRows}}),e._v(" "),i("modbus-generic-bacnet-point-mapping-import-dialog",{attrs:{"bacnet-points":e.bacnetPoints,"generic-points":e.genericPoints,"modbus-points":e.modbusPoints,"is-open":e.openImportMappingDialog,close:e.closeImportMappingDialog,"sync-data":e.syncData,"data-rows":e.dataRows}})],1)}),[],!1,null,null,null).exports},data:function(){return{tab:0,tabs:["rubix-bacnet-points-mapping","lora-generic-bacnet-mapping","modbus-generic-bacnet-mapping"],isDisabled:!1}},watch:{"$route.query.tab":function(e){this.tab=this.tabs.indexOf(e)},tab:function(e,t){var i=this.$route.query.tab;if(i!==this.tabs[e]){var n=this.tabs[e];this.$router.push({path:"service-mapping",query:{tab:n}})}}},mounted:function(){var e=this.$route.query.tab;this.tab=this.tabs.indexOf(e)}},qe=Object(u.a)(je,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-tabs",{attrs:{dark:""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[i("v-tab",{key:0},[e._v("Rubix Points <> BACnet Points ")]),e._v(" "),i("v-tab",{key:1},[e._v("LoRa Points <> Rubix | BACnet Points ")]),e._v(" "),i("v-tab",{key:2},[e._v("Modbus Points <> Rubix | BACnet Points ")])],1),e._v(" "),i("v-tabs-items",{model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[i("v-tab-item",{key:0},[i("rubix-bacnet-points-mapping")],1),e._v(" "),i("v-tab-item",{key:1},[i("lora-generic-bacnet-points-mapping")],1),e._v(" "),i("v-tab-item",{key:2},[i("modbus-generic-bacnet-points-mapping")],1)],1)],1)}),[],!1,null,null,null);t.default=qe.exports},vQiG:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"f",(function(){return s})),i.d(t,"c",(function(){return r})),i.d(t,"g",(function(){return o})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return l}));var n={success:"Successfully updated status change.",error:"Status change unsuccessful."},a={success:"Successfully updated setting.",error:"Status change unsucessful."},s={success:"Upgrade successful.",error:"Upgrade unsuccessful."},r={success:"Successfully created mapping.",error:"Mapping could not be created."},o={success:"Successfully updated mapping.",error:"Mapping could not be updated."},c={success:"Successfully deleted mapping",error:"Mapping could not be deleted"},l={success:"Successfully deleted mapping(s)",error:"Mapping(s) could not be deleted"}}}]);
//# sourceMappingURL=6.b1d4dca7f7667c9f3004.js.map