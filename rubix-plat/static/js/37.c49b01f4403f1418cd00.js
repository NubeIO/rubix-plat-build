(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"0TWu":function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r("Kz1y"),n=r.n(i),a=r("t3kO"),s=r.n(a),o=function(e,t,r){return e.name+":"+t.name+":"+r.name},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[],r=!0,i=!1,a=void 0;try{for(var l,u=s()(e);!(r=(l=u.next()).done);r=!0){var c=l.value;if(c.devices){var d=!0,f=!1,m=void 0;try{for(var h,v=s()(c.devices);!(d=(h=v.next()).done);d=!0){var p=h.value;if(p.points){var _=!0,g=!1,w=void 0;try{for(var C,y=s()(p.points);!(_=(C=y.next()).done);_=!0){var b=C.value,k=n()({},b,{networkName:c.name,deviceName:p.name,displayName:o(c,p,b)});t.push(k)}}catch(e){g=!0,w=e}finally{try{!_&&y.return&&y.return()}finally{if(g)throw w}}}}}catch(e){f=!0,m=e}finally{try{!d&&v.return&&v.return()}finally{if(f)throw m}}}}}catch(e){i=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}return t}},"5Vrd":function(e,t,r){"use strict";r.r(t);var i=r("Kz1y"),n=r.n(i),a=r("edSL"),s=r.n(a),o=r("TcPG"),l=r.n(o),u=r("tKj8"),c=r("L9C3"),d={name:"rf-writer-form",props:["isEdit","onCancel","onSave","item","isSaving","consumerId","producerThingClass","allPoints","schedules"],data:function(){return{isFetchingAllDevices:!1,rules:{required:function(e){return!!e||"Required."},numberRule:function(e){return!isNaN(parseFloat(e))||"Required."}},valid:!1,formValues:n()({},{writer_thing_class:null,writer_thing_type:null,writer_thing_uuid:null,consumer_uuid:null}),thingTypes:c.c,thingActions:c.b}},computed:{lowerCaseTitle:function(){return"writer"},titleCase:function(){return"Writer"},title:function(){return this.isEdit?"Edit "+this.titleCase:"Create "+this.titleCase},saveTitle:function(){return this.isEdit?"Save":"Create"}},mounted:function(){this.isEdit&&this.item&&(this.formValues=n()({},this.formValues,this.item)),!this.isEdit&&this.consumerId&&(this.formValues=n()({},this.formValues,{writer_thing_class:this.producerThingClass,consumer_uuid:this.consumerId}))},methods:{cleanUp:function(){this.formValues={},"function"==typeof this.onCancel&&this.onCancel()},onSubmit:function(){var e=this;if(this.$refs.form.validate()){if("function"!=typeof this.onSave)throw new Error(this.lowerCaseTitle+" form onSave function not passed");return this.onSave(this.formValues).then((function(){e.$toasted.show("Successfully "+(e.isEdit?"updated":"created")+" "+e.lowerCaseTitle+"."),e.cleanUp(!0)})).catch((function(){e.$toasted.show("Failed to "+(e.isEdit?"update":"create")+" "+e.lowerCaseTitle+".",{type:"error"})}))}}}},f=r("psIG"),m=Object(f.a)(d,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-card",[r("v-card-title",[r("span",{staticClass:"headline"},[e._v(e._s(e.title))])]),e._v(" "),r("v-card-text",[r("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[r("v-row",{attrs:{dense:""}},[r("v-col",{attrs:{cols:"12"}},[r("v-select",{attrs:{label:"Thing Class","item-value":"name",disabled:!0,items:e.thingTypes,"item-text":"displayName"},model:{value:e.formValues.writer_thing_class,callback:function(t){e.$set(e.formValues,"writer_thing_class",t)},expression:"formValues.writer_thing_class"}})],1),e._v(" "),"point"===e.formValues.writer_thing_class?r("v-col",{attrs:{cols:"12"}},[r("v-autocomplete",{attrs:{chips:"",clearable:"","small-chips":"",label:"Point","item-value":"uuid","item-text":"displayName",items:e.allPoints,loading:e.isFetchingAllDevices,rules:[e.rules.required],"deletable-chips":""},model:{value:e.formValues.writer_thing_uuid,callback:function(t){e.$set(e.formValues,"writer_thing_uuid",t)},expression:"formValues.writer_thing_uuid"}})],1):e._e(),e._v(" "),"schedule"===e.formValues.writer_thing_class?r("v-col",{attrs:{cols:"12"}},[r("v-autocomplete",{attrs:{chips:"",clearable:"","small-chips":"",label:"Scheulde","item-value":"uuid","item-text":"name",items:e.schedules,loading:e.isFetchingSchedules,rules:[e.rules.required],"deletable-chips":""},model:{value:e.formValues.writer_thing_uuid,callback:function(t){e.$set(e.formValues,"writer_thing_uuid",t)},expression:"formValues.writer_thing_uuid"}})],1):e._e()],1)],1)],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-card-actions",{staticClass:"align-end justify-end"},[r("v-btn",{attrs:{color:"darken-1",text:""},on:{click:e.onCancel}},[e._v(" Cancel ")]),e._v(" "),r("v-btn",{attrs:{color:"blue darken-1",loading:e.isSaving,text:""},on:{click:function(t){return e.onSubmit(e.formValues)}}},[e._v(" "+e._s(e.saveTitle)+" ")])],1)],1)}),[],!1,null,null,null).exports,h=r("CfmX"),v=r("97BG"),p=r("Ui9F"),_=r("TZD0"),g=r("SQfd"),w=r("qhTB"),C={writerActionDialog:"writerActionDialog",scheduleActionDialog:"scheduleActionDialog"},y={name:"rf-writers-grid",components:{GenericGrid:h.a,WritersForm:m,TooltipIconButton:p.a,PointWriterActionsForm:g.a,CalendarView:u.a},props:["params","getDataCb","allPoints","schedules","producerThingClass"],data:function(){var e;return{renderCalendarView:0,selectedItem:{},selectedCalendarConfig:{},selectedCalendarData:null,isLoadingCalendar:!1,calendarData:{},syncGrid:function(e){return e},dialogNames:n()({},C),dialog:(e={},l()(e,C.writerActionDialog,!1),l()(e,C.scheduleActionDialog,!1),e),gridName:v.p,service:_.a,toolbarTitle:"Writers",gridHeaders:[{text:"Thing class",align:"center",value:"writer_thing_class",sortable:!0},{text:"Thing type",align:"center",value:"writer_thing_type",sortable:!0},{text:"Actions",align:"center",value:"actions",sortable:!0}]}},computed:{consumerId:function(){return this.$route.params.consumerId},consumer:function(){return{uuid:this.params.uuid}}},methods:{toggleDialog:function(e,t,r){this.selectedItem=t,this.syncGrid=r,this.dialog[e]=!this.dialog[e],this.dialog[e]?this.selectedItem=t:this.selectedItem=null},closeDialog:function(e){this.dialog[e]=!1,this.selectedItem={}},onAssignWriteAction:function(e){var t=this,r=this.selectedItem.uuid;return w.b(r,e).then((function(e){return"function"==typeof t.syncGrid&&t.syncGrid(),e}))},onExpandClick:function(e){var t=e.expand,r=e.isExpanded,i=e.item,n=!r;t(n),n?(this.selectedItem=i,this.fetchCalendarData()):this.selectedCalendarData=null},updateCalendarView:function(e,t,r){var i=this;return w.a(e,t,r).then((function(e){return i.fetchCalendarData(),e}))},fetchCalendarData:function(){var e=this,t=this.selectedItem.uuid;return this.isLoadingCalendar=!0,_.a.fetchById(t).then((function(r){var i=r&&r.data_store&&r.data_store.schedules||{},a=r&&r.data_store&&r.data_store.config||{};return e.calendarData[t]=n()({},i),e.selectedCalendarConfig=n()({},a),e.selectedCalendarData=n()({},i),e.renderCalendarView++,r})).finally((function(){e.isLoadingCalendar=!1}))}}},b=Object(f.a)(y,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("generic-grid",{attrs:{params:e.params,service:e.service,gridName:e.gridName,isHeaderConfigurable:!0,headers:e.gridHeaders,toolbarTitle:e.toolbarTitle,showExpand:!0,getDataCb:e.getDataCb,singleExpand:!0},scopedSlots:e._u([{key:"createForm",fn:function(t){var i=t.onSave,n=t.onClose,a=t.isOpen,s=t.isSaving;return[a?r("writers-form",{attrs:{isEdit:!1,onSave:i,onCancel:n,isSaving:s,allPoints:e.allPoints,schedules:e.schedules,consumerId:e.consumerId,producerThingClass:e.producerThingClass}}):e._e()]}},{key:"editForm",fn:function(t){var i=t.onSave,n=t.item,a=t.onClose,s=t.isOpen,o=t.isSaving;return[s?r("writers-form",{attrs:{item:n,isEdit:!0,onSave:i,onCancel:a,isSaving:o,schedules:e.schedules,allPoints:e.allPoints,consumerId:e.consumerId,producerThingClass:e.producerThingClass}}):e._e()]}},{key:"afterActions",fn:function(t){var i=t.item,n=t.refreshGrid;return["point"===i.item.writer_thing_class?r("tooltip-icon-button",{attrs:{btnTooltip:"Assign Point Action",btnIcon:"mdi-yelp",btnColor:"orange",onClick:function(){return e.toggleDialog(e.dialogNames.writerActionDialog,i.item,n)}}}):e._e()]}},{key:"expansionIcon",fn:function(t){var i=t.expand,n=t.isExpanded,a=t.item;return["schedule"===a.writer_thing_class?r("tooltip-icon-button",{attrs:{btnTooltip:"Assign Schedule Action",btnIcon:"mdi-calendar",btnColor:"orange",buttonSize:"medium",onClick:function(){return e.onExpandClick({expand:i,isExpanded:n,item:a})}}}):e._e()]}},{key:"expansionView",fn:function(t){t.headers;var i=t.item;return[r("div",[!e.selectedCalendarData&&e.isLoadingCalendar?r("v-progress-circular",{attrs:{size:"20",indeterminate:""}}):e._e(),e._v(" "),e.selectedCalendarData?r("calendar-view",{key:e.renderCalendarView,attrs:{data:e.selectedCalendarData,config:e.selectedCalendarConfig,isLoadingCalendar:e.isLoadingCalendar,updateData:function(t,r){return e.updateCalendarView(i.uuid,t,r)}}}):e._e()],1)]}}])}),e._v(" "),r("v-dialog",{attrs:{persistent:"","max-width":"500px"},model:{value:e.dialog[e.dialogNames.writerActionDialog],callback:function(t){e.$set(e.dialog,e.dialogNames.writerActionDialog,t)},expression:"dialog[dialogNames.writerActionDialog]"}},[e.dialog[e.dialogNames.writerActionDialog]?r("point-writer-actions-form",{attrs:{onCancel:function(){return e.closeDialog(e.dialogNames.writerActionDialog)},item:e.selectedItem,onSave:e.onAssignWriteAction}}):e._e()],1)],1)}),[],!1,null,null,null).exports,k=r("oGAK"),x=r("LmcY"),I=r("2SyR"),N=r("VNy9"),A=r("wffz"),S=r("vJYM"),D=r("0TWu"),V={name:"writers",data:function(){return{params:{uuid:null,with_writers:!0},renderCount:0,producerThingClass:null,gridData:{},breadcrumbItems:[],schedules:[],allPoints:[]}},components:{IconButton:I.a,WritersGrid:b,Breadcrumbs:N.a,TooltipIconButton:p.a},mounted:function(){this.initialize(),this.fetchSchedules(),this.fetchAllPoint()},watch:{"$route.params.consumerId":function(e,t){e!=t&&(this.renderCount++,this.initialize())},flowNetworkCloneNamesMap:function(){this.setBreadCrumbs()}},computed:{flowNetworkCloneNamesMap:function(){return this.$store.state.flowNetworkCloneNamesMap}},methods:{initialize:function(){this.params=n()({},this.params,{uuid:this.$route.params.consumerId}),this.setBreadCrumbs()},fetchSchedules:function(){var e=this;S.a.fetch().then((function(t){return e.schedules=t,t}))},fetchAllPoint:function(){var e=this;A.a.fetch({with_points:!0}).then((function(t){return e.allPoints=D.a(t),t}))},onBack:function(){this.$router.go(-1)},getDataCb:function(e){this.gridData=e,this.producerThingClass=s()(this.gridData,"extraData.producer_thing_class",null)},setBreadCrumbs:function(){this.breadcrumbItems=[],this.breadcrumbItems.push({text:"All Flow Network Clone",align:"center",disabled:!1,link:k.a.rfFlowNetworkClone}),this.breadcrumbItems.push({text:x.a(this.flowNetworkCloneNamesMap,this.$route.params.flowNetworkId),align:"center",disabled:!1,link:k.a.rfFlowNetworkStreamsClone.replace(":flowNetworkId",this.$route.params.flowNetworkId)}),this.breadcrumbItems.push({text:x.a(this.flowNetworkCloneNamesMap,this.$route.params.streamId),align:"center",disabled:!1,link:k.a.rfFlowNetworkCloneConsumers.replace(":flowNetworkId",this.$route.params.flowNetworkId).replace(":streamId",this.$route.params.streamId)}),this.breadcrumbItems.push({text:x.a(this.flowNetworkCloneNamesMap,this.$route.params.consumerId),align:"center",disabled:!1})}}},T=Object(f.a)(V,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-card",{key:e.renderCount,attrs:{outlined:""}},[r("v-card-title",[r("v-btn",{staticClass:"mr-1",attrs:{icon:"",medium:""},on:{click:e.onBack}},[r("v-icon",{attrs:{medium:""}},[e._v(" mdi-arrow-left ")])],1),e._v("\n    Writers\n  ")],1),e._v(" "),r("v-card-text",[r("breadcrumbs",{attrs:{items:e.breadcrumbItems}}),e._v(" "),r("v-row",{attrs:{"no-gutter":""}},[r("v-col",{attrs:{cols:"12",lg:"12",xl:"12",md:"12",sm:"12",xs:"12"}},[e.params.uuid?r("writers-grid",{attrs:{params:e.params,getDataCb:e.getDataCb,allPoints:e.allPoints,schedules:e.schedules,producerThingClass:e.producerThingClass}}):e._e()],1)],1)],1)],1)}),[],!1,null,null,null);t.default=T.exports},L9C3:function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"c",(function(){return _})),r.d(t,"b",(function(){return g}));var i,n=r("TcPG"),a=r.n(n),s="api",o="point",l="point_filter",u="internal_api",c="external_api",d="schedule",f="global_schedule",m="alert",h="mapping",v=(i={},a()(i,s,{displayName:"API",name:s,value:s}),a()(i,o,{displayName:"Point",name:o,value:o}),a()(i,l,{displayName:"Point Filter",name:l,value:o}),a()(i,u,{displayName:"InternalAPI",name:u,value:u}),a()(i,c,{displayName:"ExternalAPI",name:c,value:c}),a()(i,d,{displayName:"Schedule",name:d,value:d}),a()(i,f,{displayName:"GlobalSchedule",name:f,value:f}),a()(i,m,{displayName:"Alert",name:m}),i),p=a()({},h,{displayName:"Mapping",name:h}),_=[v.point,v.schedule],g=[p.mapping]},LmcY:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r("edSL");var i=function(e,t){var r=e&&e[t];return r||(r=t),r}},SQfd:function(e,t,r){"use strict";var i=r("tZmG"),n=r.n(i),a=r("Kz1y"),s=r.n(a),o=r("08eb"),l=r.n(o),u=r("yEOx"),c=r.n(u),d={WRITE:"write",READ:"read"},f=function(e){return null==e?null:"number"==typeof e?e:void 0},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.action,r=e.ask_refresh,i=e.priority,n=void 0===i?{}:i,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s={action:t||d.WRITE,ask_refresh:void 0===r||r,priority:{_1:f(n._1),_2:f(n._2),_3:f(n._3),_4:f(n._4),_5:f(n._5),_6:f(n._6),_7:f(n._7),_8:f(n._8),_9:f(n._9),_10:f(n._10),_11:f(n._11),_12:f(n._12),_13:f(n._13),_14:f(n._14),_15:f(n._15),_16:f(n._16)}};return a&&(delete s.action,delete s.ask_refresh),s},h={name:"rf-point-writer-actions-form",props:["onCancel","onSave","item","priorityArrayOnly"],data:function(e){return{isSaving:!1,writerActions:l()(d),priorityList:["_1","_2","_3","_4","_5","_6","_7","_8","_9","_10","_11","_12","_13","_14","_15","_16"],rules:{required:function(e){return!!e||"Required."},numberRule:function(e){return!isNaN(parseFloat(e))||"Required."}},valid:!1,formValues:s()({},m({},e.priorityArrayOnly))}},computed:{lowerCaseTitle:function(){return"write priority array"},titleCase:function(){return"Write Priority Array"},title:function(){return this.isEdit?"Edit "+this.titleCase:"Create "+this.titleCase},saveTitle:function(){return this.isEdit?"Save":"Create"}},mounted:function(){this.item&&n()(this.item).length>0&&(this.formValues=m({ask_refresh:this.item.ask_refresh,action:this.item.action,priority:this.item.data_store||this.item.priority},this.priorityArrayOnly))},methods:{cleanUp:function(){this.formValues=m({},this.priorityArrayOnly),"function"==typeof this.onCancel&&this.onCancel()},transformFormValues:function(e){var t=c()(e);return t.priority=n()(t.priority).reduce((function(e,r){return t.priority[r]?e[r]=+t.priority[r]:e[r]=null,e}),{}),t},onSubmit:function(){var e=this;if(this.$refs.form.validate()){if("function"!=typeof this.onSave)throw new Error(this.lowerCaseTitle+" form onSave function not passed");return this.isSaving=!0,this.onSave(this.transformFormValues(this.formValues)).then((function(){e.$toasted.show("Successfully "+(e.isEdit?"updated":"created")+" "+e.lowerCaseTitle+".")})).catch((function(t){e.$toasted.show("Failed to "+(e.isEdit?"update":"create")+" "+e.lowerCaseTitle+".",{type:"error"})})).finally((function(){e.isSaving=!1}))}}}},v=r("psIG"),p=Object(v.a)(h,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-card",[r("v-card-title",[r("span",{staticClass:"headline"},[e._v(e._s(e.title))])]),e._v(" "),r("v-card-text",[r("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[r("v-row",{attrs:{dense:""}},[r("v-col",{attrs:{cols:"6"}},[e.priorityArrayOnly?e._e():r("v-select",{attrs:{label:"Action",items:e.writerActions},model:{value:e.formValues.action,callback:function(t){e.$set(e.formValues,"action",t)},expression:"formValues.action"}})],1),e._v(" "),r("v-col",{attrs:{cols:"1"}}),e._v(" "),r("v-col",{attrs:{cols:"5"}},[e.priorityArrayOnly?e._e():r("v-switch",{staticClass:"pr-4",attrs:{inset:"",label:"Ask Refresh",color:"primary"},model:{value:e.formValues.ask_refresh,callback:function(t){e.$set(e.formValues,"ask_refresh",t)},expression:"formValues.ask_refresh"}})],1),e._v(" "),r("v-row",{attrs:{dense:""}},[r("v-col",{staticClass:"text-left",attrs:{cols:"12"}},[r("span",{staticClass:"caption"},[e._v("Priority Array")])]),e._v(" "),e._l(e.priorityList,(function(t){return r("v-col",{key:t,attrs:{cols:"3"}},[e.formValues.priority?r("v-text-field",{attrs:{"single-line":"",dense:"",outlined:"",required:"",step:"0.01",type:"number",label:t},model:{value:e.formValues.priority[t],callback:function(r){e.$set(e.formValues.priority,t,r)},expression:"formValues.priority[priorityKey]"}}):e._e()],1)}))],2)],1)],1)],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-card-actions",{staticClass:"align-end justify-end"},[r("v-btn",{attrs:{color:"darken-1",text:""},on:{click:e.onCancel}},[e._v(" Close ")]),e._v(" "),r("v-btn",{attrs:{color:"blue darken-1",loading:e.isSaving,text:""},on:{click:function(t){return e.onSubmit(e.formValues)}}},[e._v("\n      Send "),r("v-icon",[e._v("mdi-send")])],1)],1)],1)}),[],!1,null,null,null);t.a=p.exports},TZD0:function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var i=r("tZmG"),n=r.n(i),a=r("YUSd"),s=r.n(a),o=r("Zv/C"),l=r.n(o),u=r("2lBV"),c=r.n(u),d=r("Dkg+"),f=r.n(d),m=r("Gjrs"),h=r.n(m),v=r("DeKB"),p=r("oCli"),_=r("uzYq"),g=r("PWxN"),w=r.n(g),C=r("NWgQ"),y=r.n(C),b=new(function(e){function t(){l()(this,t);var e=f()(this,(t.__proto__||s()(t)).call(this,p.a.rfWriters));return e.fetch=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.uuid||e.id;if(!t)throw new Error("Consumer Id is required for fetching writers of consumers");var r=p.a.rfConsumers(t);return(e=w()(e,["uuid","id"]))&&n()(e).length>0&&(r=r+"?"+y.a.stringify(e)),_.a.get(r).then((function(e){return{dataItems:e.writers,extraData:w()(e,["writers"])}}))},e.createWriter=function(t){var r=e.evaluateUri()+"/wizard";return _.a.post(r,t)},e}return h()(t,e),c()(t,[{key:"fetchAll",value:function(){var e=p.a.rfWriters();return _.a.get(e)}}]),t}(v.a))},qhTB:function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return s}));var i=r("uzYq"),n=r("oCli").a.rfWriterActions,a=function(e,t){var r=n(e);return i.a.post(r,t)},s=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n(e),s={ask_refresh:!0,action:"write",schedule:{schedules:t,config:r}};return i.a.post(a,s)}},wffz:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r("DeKB"),n=r("oCli"),a=new i.a(n.a.rfNetworks)}}]);
//# sourceMappingURL=37.c49b01f4403f1418cd00.js.map